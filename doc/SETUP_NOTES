HOW THIS APPLICATION WAS CREATED

  rails wincent_on_rails
  cd wincent_on_rails
  rake rails:freeze:gems
  script/plugin install svn://rubyforge.org/var/svn/rspec/tags/CURRENT/rspec
  script/plugin install svn://rubyforge.org/var/svn/rspec/tags/CURRENT/rspec_on_rails
  script/plugin install http://thmadb.com/public_svn/plugins/fixture_replacement

  # note: cannot use script/plugin here or Haml will install as "stable"
  svn export svn://svn.hamptoncatlin.com/haml/tags/stable vendor/plugins/haml

  # set up databases
  sudo -b mysqld_safe
  mysql -u root -e "CREATE DATABASE wincent_on_rails_development CHARACTER SET 'UTF8';"
  mysql -u root -e "CREATE DATABASE wincent_on_rails_test CHARACTER SET 'UTF8';"
  rake db:migrate

  # bootstrap RSpec
  script/generate rspec
  rake spec

  # bootstrap FixtureReplacement
  script/generate fixture_replacement

  # upgrade to Rails 2.0 preview (1.2.4.7499)
  cd ..
  rails wincent_on_rails
  cd wincent_on_rails
  rake rails:freeze:gems

  # RSpec 1.0.8 (latest release) doesn't work with the preview; must move to trunk
  rm -r vendor/plugins/rspec vendor/plugins/rspec_on_rails
  script/plugin install svn://rubyforge.org/var/svn/rspec/trunk/rspec
  script/plugin install svn://rubyforge.org/var/svn/rspec/trunk/rspec_on_rails
  script/generate rspec

  # upgrade to Rails 2.0 RC 1
  rake rails
  rake rails:freeze:edge TAG=rel_2-0-0_RC1

  # upgrade gem as well (for rails tool); should have done it this way all along
  sudo gem install rails --source http://gems.rubyonrails.org --version 1.99.0
  rm vendor/rails/TAG_rel_2-0-0_RC1
  rake rails:freeze:gems
  cd ..
  rails wincent_on_rails

  # update RSpec at the same time (revision 2902)
  rm -r vendor/plugins/rspec vendor/plugins/rspec_on_rails
  script/plugin install svn://rubyforge.org/var/svn/rspec/trunk/rspec
  script/plugin install svn://rubyforge.org/var/svn/rspec/trunk/rspec_on_rails
  script/generate rspec

  # also update FixtureReplacement (revision 83)
  rm -r vendor/plugins/fixture_replacement
  script/plugin install http://thmadb.com/public_svn/plugins/fixture_replacement

  # upgrade to Rails 2.0 RC 2 (gem version 1.99.1)
  sudo gem install rails --source http://gems.rubyonrails.org --version 1.99.1
  rake rails:freeze:gems
  cd ..
  rails wincent_on_rails

  # also update FixtureReplacement (revision 140)
  rm -r vendor/plugins/fixture_replacement
  script/plugin install http://thmadb.com/public_svn/plugins/fixture_replacement

  # update RSpec at the same time (revision 3014)
  git rm -r vendor/plugins/rspec vendor/plugins/rspec_on_rails
  script/plugin install svn://rubyforge.org/var/svn/rspec/trunk/rspec
  script/plugin install svn://rubyforge.org/var/svn/rspec/trunk/rspec_on_rails
  git add vendor/plugins/rspec vendor/plugins/rspec_on_rails
  script/generate rspec
  # manually merge spec/spec_helper.rb, then:
  git add spec/spec_helper.rb

  # install mysql gem for Leopard
  sudo env ARCHFLAGS="-arch i386" gem install mysql -- --with-mysql-config=/usr/local/bin/mysql_config

  # recreate databases for Leopard
  sudo -b mysqld_safe
  mysql -u root -e "CREATE DATABASE wincent_on_rails_development CHARACTER SET 'UTF8';"
  mysql -u root -e "CREATE DATABASE wincent_on_rails_test CHARACTER SET 'UTF8';"
  rake db:migrate

  # Haml 1.8.0 upgrade
  git rm -r vendor/plugins/haml
  svn export svn://hamptoncatlin.com/haml/tags/rel_1-8-0 vendor/plugins/haml
  git add vendor/plugins/haml

  # upgrade to Rails 2.0.2 (vastly simplifying)
  sudo gem install rails
  rake rails:freeze:gems
  rails .

  # upgrade to latest RSpec (1.1.1, same for 1.1.2, 1.1.3)
  git rm -r vendor/plugins/rspec
  git rm -r vendor/plugins/rspec_on_rails
  script/plugin install svn://rubyforge.org/var/svn/rspec/tags/CURRENT/rspec
  script/plugin install --force svn://rubyforge.org/var/svn/rspec/tags/CURRENT/rspec_on_rails
  git add vendor/plugins/rspec
  git add vendor/plugins/rspec_on_rails
  script/generate rspec

  # Haml 1.8.1 upgrade
  git rm -r vendor/plugins/haml
  svn export svn://hamptoncatlin.com/haml/tags/rel_1-8-1 vendor/plugins/haml
  git add vendor/plugins/haml

  # Haml 1.8.2 upgrade: now we just unpack the gem into vendor
  sudo gem install haml
  git rm -rf vendor/plugins/haml
  mkdir -p vendor/gems
  $(cd vendor/gems && gem unpack haml)
  git add vendor/gems

  # seeing as this is the first time we're unpacking into vendor, must tweak environment as well
  git add environment.rb

NOTE: I later had to undo all this because Haml is a bit of an odd one out
and will prevent the server from starting if installed in this way. So I
ended up moving it back to vendor/plugins, which funnily enough works:

  git mv vendor/gems/haml-1.8.2 vendor/plugins/

  # installing webrat (for testing)
  script/plugin install http://svn.eastmedia.net/public/plugins/webrat/
  git add vendor/plugins/webrat

  # RSpec 1.1.4 upgrade: note that this coincides with RSpecs move to GitHub
  git rm -r vendor/plugins/rspec vendor/plugins/rspec_on_rails
  git clone git://github.com/dchelimsky/rspec.git vendor/plugins/rspec
  (cd vendor/plugins/rspec && git co 1.1.4)
  rm -rf vendor/plugins/rspec/.git
  git clone git://github.com/dchelimsky/rspec-rails.git vendor/plugins/rspec-rails
  (cd vendor/plugins/rspec-rails && git co 1.1.4)
  rm -rf vendor/plugins/rspec-rails/.git
  git add vendor/plugins/rspec vendor/plugins/rspec-rails

  # Haml 2.0 upgrade: again, coincides with a move to GitHub
  sudo gem install haml --no-ri
  git rm -r vendor/plugins/haml
  git clone git://github.com/nex3/haml.git vendor/plugins/haml
  (cd vendor/plugins/haml && git co 2.0.0)
  rm -rf vendor/plugins/haml/.git
  git add vendor/plugins/haml

  # Rails 2.1.0_RC1 upgrade: again, coincides with a move to GitHub
  git rm -r vendor/rails
  git clone git://github.com/rails/rails.git vendor/rails
  (cd vendor/rails && git co v2.1.0_RC1)
  rm -rf vendor/rails/.git
  add vendor/rails
  rake rails:update
  git add script/dbconsole
  git add -u

  # Rails 2.1 upgrade
  sudo gem install rails
  rake rails:freeze:gems
  (cd .. && rails src)
  rake spec

  # Haml 2.0.2 upgrade
  sudo gem install haml --no-ri
  git rm -r vendor/plugins/haml
  rake gems:unpack
  rake spec
  git add vendor/gems/haml
