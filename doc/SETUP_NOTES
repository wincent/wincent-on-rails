HOW THIS APPLICATION WAS CREATED

  rails wincent_on_rails
  cd wincent_on_rails
  rake rails:freeze:gems
  script/plugin install svn://rubyforge.org/var/svn/rspec/tags/CURRENT/rspec
  script/plugin install svn://rubyforge.org/var/svn/rspec/tags/CURRENT/rspec_on_rails
  script/plugin install http://thmadb.com/public_svn/plugins/fixture_replacement

  # note: cannot use script/plugin here or Haml will install as "stable"
  svn export svn://svn.hamptoncatlin.com/haml/tags/stable vendor/plugins/haml

  # set up databases
  sudo -b mysqld_safe
  mysql -u root -e "CREATE DATABASE wincent_on_rails_development CHARACTER SET 'UTF8';"
  mysql -u root -e "CREATE DATABASE wincent_on_rails_test CHARACTER SET 'UTF8';"
  rake db:migrate

  # bootstrap RSpec
  script/generate rspec
  rake spec

  # bootstrap FixtureReplacement
  script/generate fixture_replacement

  # update to Rails 2.0 preview (1.2.4.7499)
  cd ..
  rails wincent_on_rails
  cd wincent_on_rails
  rake rails:freeze:gems

  # RSpec 1.0.8 (latest release) doesn't work with the preview; must move to trunk
  rm -r vendor/plugins/rspec vendor/plugins/rspec_on_rails
  script/plugin install svn://rubyforge.org/var/svn/rspec/trunk/rspec
  script/plugin install svn://rubyforge.org/var/svn/rspec/trunk/rspec_on_rails
  script/generate rspec

  # update to Rails 2.0 RC 1
  rake rails
  rake rails:freeze:edge TAG=rel_2-0-0_RC1

  # update gem as well (for rails tool); should have done it this way all along
  sudo gem install rails --source http://gems.rubyonrails.org --version 1.99.0
  rm vendor/rails/TAG_rel_2-0-0_RC1
  rake rails:freeze:gems
  cd ..
  rails wincent_on_rails

  # update RSpec at the same time (revision 2902)
  rm -r vendor/plugins/rspec vendor/plugins/rspec_on_rails
  script/plugin install svn://rubyforge.org/var/svn/rspec/trunk/rspec
  script/plugin install svn://rubyforge.org/var/svn/rspec/trunk/rspec_on_rails
  script/generate rspec

  # also update FixtureReplacement (revision 83)
  rm -r vendor/plugins/fixture_replacement
  script/plugin install http://thmadb.com/public_svn/plugins/fixture_replacement

  # update to Rails 2.0 RC 2 (gem version 1.99.1)
  sudo gem install rails --source http://gems.rubyonrails.org --version 1.99.1
  rake rails:freeze:gems
  cd ..
  rails wincent_on_rails

  # also update FixtureReplacement (revision 140)
  rm -r vendor/plugins/fixture_replacement
  script/plugin install http://thmadb.com/public_svn/plugins/fixture_replacement

  # update RSpec at the same time (revision 3014)
  git rm -r vendor/plugins/rspec vendor/plugins/rspec_on_rails
  script/plugin install svn://rubyforge.org/var/svn/rspec/trunk/rspec
  script/plugin install svn://rubyforge.org/var/svn/rspec/trunk/rspec_on_rails
  git add vendor/plugins/rspec vendor/plugins/rspec_on_rails
  script/generate rspec
  # manually merge spec/spec_helper.rb, then:
  git add spec/spec_helper.rb

  # install mysql gem for Leopard
  sudo env ARCHFLAGS="-arch i386" gem install mysql -- --with-mysql-config=/usr/local/bin/mysql_config

  # recreate databases for Leopard
  sudo -b mysqld_safe
  mysql -u root -e "CREATE DATABASE wincent_on_rails_development CHARACTER SET 'UTF8';"
  mysql -u root -e "CREATE DATABASE wincent_on_rails_test CHARACTER SET 'UTF8';"
  rake db:migrate

  # Haml 1.8.0 update
  git rm -r vendor/plugins/haml
  svn export svn://hamptoncatlin.com/haml/tags/rel_1-8-0 vendor/plugins/haml
  git add vendor/plugins/haml

  # update to Rails 2.0.2 (vastly simplifying)
  sudo gem install rails
  rake rails:freeze:gems
  rails .

  # update to latest RSpec (1.1.1, same for 1.1.2, 1.1.3)
  git rm -r vendor/plugins/rspec
  git rm -r vendor/plugins/rspec_on_rails
  script/plugin install svn://rubyforge.org/var/svn/rspec/tags/CURRENT/rspec
  script/plugin install --force svn://rubyforge.org/var/svn/rspec/tags/CURRENT/rspec_on_rails
  git add vendor/plugins/rspec
  git add vendor/plugins/rspec_on_rails
  script/generate rspec

  # Haml 1.8.1 update
  git rm -r vendor/plugins/haml
  svn export svn://hamptoncatlin.com/haml/tags/rel_1-8-1 vendor/plugins/haml
  git add vendor/plugins/haml

  # Haml 1.8.2 update: now we just unpack the gem into vendor
  sudo gem install haml
  git rm -rf vendor/plugins/haml
  mkdir -p vendor/gems
  $(cd vendor/gems && gem unpack haml)
  git add vendor/gems

  # seeing as this is the first time we're unpacking into vendor, must tweak environment as well
  git add environment.rb

NOTE: I later had to undo all this because Haml is a bit of an odd one out
and will prevent the server from starting if installed in this way. So I
ended up moving it back to vendor/plugins, which funnily enough works:

  git mv vendor/gems/haml-1.8.2 vendor/plugins/

  # installing webrat (for testing)
  script/plugin install http://svn.eastmedia.net/public/plugins/webrat/
  git add vendor/plugins/webrat

  # RSpec 1.1.4 update: note that this coincides with RSpecs move to GitHub
  git rm -r vendor/plugins/rspec vendor/plugins/rspec_on_rails
  git clone git://github.com/dchelimsky/rspec.git vendor/plugins/rspec
  (cd vendor/plugins/rspec && git co 1.1.4)
  rm -rf vendor/plugins/rspec/.git
  git clone git://github.com/dchelimsky/rspec-rails.git vendor/plugins/rspec-rails
  (cd vendor/plugins/rspec-rails && git co 1.1.4)
  rm -rf vendor/plugins/rspec-rails/.git
  git add vendor/plugins/rspec vendor/plugins/rspec-rails

  # Haml 2.0 update: again, coincides with a move to GitHub
  sudo gem install haml --no-ri
  git rm -r vendor/plugins/haml
  git clone git://github.com/nex3/haml.git vendor/plugins/haml
  (cd vendor/plugins/haml && git co 2.0.0)
  rm -rf vendor/plugins/haml/.git
  git add vendor/plugins/haml

  # Rails 2.1.0_RC1 update: again, coincides with a move to GitHub
  git rm -r vendor/rails
  git clone git://github.com/rails/rails.git vendor/rails
  (cd vendor/rails && git co v2.1.0_RC1)
  rm -rf vendor/rails/.git
  add vendor/rails
  rake rails:update
  git add script/dbconsole
  git add -u

  # Rails 2.1 update
  sudo gem install rails
  rake rails:freeze:gems
  (cd .. && rails src)
  rake spec

  # Haml 2.0.2 update
  sudo gem install haml --no-ri
  git rm -r vendor/plugins/haml
  rake gems:unpack
  rake spec
  git add vendor/gems/haml-2.0.2
  # NOTE: later had to move Haml back into plug-ins seeing as it breaks the app unless the gem is also installed on the system
  # (seems to be a Haml issue as the same thing doesn't happen with other gems)
  mv vendor/gems/haml-2.0.2 vendor/plugins/haml

  # Rails 2.1.1 update
  sudo gem install rails
  rake rails:freeze:gems
  (cd .. && rails src)
  rake spec
  # NOTE: to get the specs to pass had to apply a patch
  # see: http://rails.lighthouseapp.com/projects/8994-ruby-on-rails/tickets/324
  # and: http://rails.lighthouseapp.com/attachments/43265/gem_dep_version_number_bug.diff

  # Wikitext 1.2 update
  git rm -r vendor/gems/wikitext-1.1.2
  rake gems:unpack # requires bugfix to Rails 2.1.1 bug #1003
  rake gems:build
  git add vendor/gems/wikitext-1.2
  cd vendor/gems/wikitext-1.2/ext
  git reset HEAD ./Makefile ./*.o *.log

  # Haml 2.0.3 update
  sudo gem install haml --no-ri
  git rm -r vendor/plugins/haml
  rake gems:unpack
  rake spec
  git add vendor/gems/haml-2.0.3
  # NOTE: had to move this back into vendor/plugins due to Rails bug #324:
  # http://rails.lighthouseapp.com/projects/8994/tickets/324
  mv vendor/gems/haml-2.0.3 vendor/plugins/haml
  git add vendor/plugins/haml

  # RSpec 1.1.10 update
  git rm -r vendor/plugins/rspec vendor/plugins/rspec_on_rails
  git clone git://github.com/dchelimsky/rspec.git vendor/plugins/rspec
  (cd vendor/plugins/rspec && git co 1.1.10)
  rm -rf vendor/plugins/rspec/.git
  git clone git://github.com/dchelimsky/rspec-rails.git vendor/plugins/rspec-rails
  (cd vendor/plugins/rspec-rails && git co 1.1.10)
  rm -rf vendor/plugins/rspec-rails/.git
  git add vendor/plugins/rspec vendor/plugins/rspec-rails
  script/generate rspec
  git add script/spec script/spec_server spec/spec.opts script/autospec

  # Rails 2.1.2 update
  sudo gem install rails
  rake rails:freeze:gems
  (cd .. && rails src)
  rake spec
  # NOTE: to get the specs to pass had to apply patches, as before

  # Rails 2.2.0 update (first release candidate)
  sudo gem install rails -s http://gems.rubyonrails.org -v 2.2.0
  rake rails:freeze:gems
  (cd .. && rails src)
  rake spec
  # NOTE: lots of patching required to get specs to pass

  # Rails 2.2.1 update (second release candidate, could have skipped but wanted to iron out all bugs along the way)
  sudo gem install rails -s http://gems.rubyonrails.org -v 2.2.1
  rake rails:freeze:gems
  (cd .. && rails src)
  rake spec

  # Rails 2.2.2 update (final release)
  sudo gem install rails
  rake rails:freeze:gems
  (cd .. && rails src)
  rake spec
  # NOTE: had to manually rename application.rb to application_controller.rb ("rake rails:update" also would have worked)

  # Haml 2.0.6 update
  sudo gem install haml --no-ri
  git rm -r vendor/gems/haml-2.0.3
  rake gems:unpack
  rake spec
  git add vendor/gems/haml-2.0.6

  # Wikitext 1.3.0 update
  sudo gem install wikitext
  git rm -r vendor/gems/wikitext-1.2.1
  rake gems:unpack
  rake gems:build
  cd vendor/gems/wikitext-1.3.0/ext
  rm Makefile *.o *.log
  cd -
  git add vendor/gems/wikitext-1.3.0

  # RSpec 1.1.12 update (tried installing as gem instead of plug-in for first time)
  git rm -r vendor/plugins/rspec vendor/plugins/rspec-rails
  sudo gem install rspec-rails # rspec gets installed as a dependency
  # customize config/environments/test.rb
  #   config.gem 'rspec',       :version => '1.1.12'
  #   config.gem 'rspec-rails', :version => '1.1.12'
  RAILS_ENV=test rake gems:unpack # borks
  RAILS_ENV=test rake gems:build  # didn't even get this far
  # but that didn't work, so back to the old way
  git clone git://github.com/dchelimsky/rspec.git vendor/plugins/rspec
  (cd vendor/plugins/rspec && git co 1.1.12)
  rm -rf vendor/plugins/rspec/.git
  git clone git://github.com/dchelimsky/rspec-rails.git vendor/plugins/rspec-rails
  (cd vendor/plugins/rspec-rails && git co 1.1.12)
  rm -rf vendor/plugins/rspec-rails/.git
  git add vendor/plugins/rspec vendor/plugins/rspec-rails
  script/generate rspec
  git add script/spec script/spec_server spec/spec.opts script/autospec

  # migrate to Cucumber 0.1.15/Webrat 0.3.4 (RSpec StoryRunner is broken anyway)
  git rm -r vendor/plugins/webrat # remove old version
  sudo gem install cucumber webrat
  script/generate cucumber

  # Webrat 0.3.4 doesn't work; have to use Aslak's fork
  sudo gem uninstall webrat
  sudo gem install --source http://gems.github.com aslakhellesoy-webrat
  rake features # make sure it works

  # update to Cucumber 0.1.16/Webrat 0.4.0 (no longer necessary to use the fork)
  sudo gem install webrat cucumber
  script/generate cucumber

  # Wikitext 1.4.1
  git rm -r vendor/gems/wikitext-1.4.0
  sudo gem install wikitext
  rake gems:unpack
  git add vendor/gems/wikitext-1.4.1
  rake gems:build
  git add vendor/gems/wikitext-1.4.1/ext/wikitext.bundle
  rm vendor/gems/wikitext-1.4.1/ext/Makefile
  rm vendor/gems/wikitext-1.4.1/ext/*.log
  rm vendor/gems/wikitext-1.4.1/ext/*.o

  # Rails 2.3.0 RC1 update
  sudo gem install rails --source http://gems.rubyonrails.org
  rake rails:freeze:gems
  rake rails:update
  (cd .. && rails src)

  # Haml 2.0.8 update
  git rm -r vendor/gems/haml-2.0.6 # doesn't actually delete directory
  rm -r vendor/gems/haml-2.0.6     # so must delete that manually
  vi config/environment.rb         # update config.gem line
  rake gems:unpack
  rake spec
  git add vendor/gems/haml-2.0.8
  git add config/environment.rb

  # trying out the RSpec 1.2 release candidate
  sudo gem install --source http://gems.github.com dchelimsky-rspec
  sudo gem install --source http://gems.github.com dchelimsky-rspec-rails
  git rm -r vendor/plugins/rspec vendor/plugins/rspec-rails
  rm -r vendor/plugins/rspec vendor/plugins/rspec-rails # Git doesn't remove empty directories
  # customize config/environments/test.rb with:
  #   config.gem 'dchelimsky-rspec', :lib => 'spec', :version => '1.1.99.7'
  #   config.gem 'dchelimsky-rspec-rails', :lib => 'spec/rails', :version => '1.1.99.7'
  # note that "RAILS_ENV=test rake gems:unpack" doesn't work yet
  # so can't do "git add vendor/gems/rspec" etc
  script/generate rspec
  # add one line to spec/spec_helper.rb:
  #   require 'spec/autorun'
  git add config/environments/test.rb spec/spec_helper.rb
  git add lib/tasks/rspec.rake script/spec script/spec_server
  # fix spec breakages
  git add spec

  # later was able to fix the RSpec issues
  git rm lib/tasks/rspec.rake
  # change ":lib" settings to ":lib => false"
  RAILS_ENV=test rake gems:unpack # unpacks rspec-rails
  RAILS_ENV=test rake gems:unpack:dependencies # unpacks rspec
  # delete unwanted stuff unpacked in previous step
  # (although may want to consider bundling rack in the future)
  rm -rf vendor/gems/rake-* vendor/gems/hoe-* vendor/gems/rack-* vendor/gems/rubyforge-* vendor/gems/cucumber-*
  script/generate rspec # to create new lib/tasks/rspec.rake file

  # Haml 2.0.9 update
  sudo gem install --no-ri haml
  git rm -r vendor/gems/haml-2.0.8 # doesn't actually delete directory
  rm -r vendor/gems/haml-2.0.8     # so must delete that manually
  vi config/environment.rb         # update config.gem line
  rake gems
  rake gems:unpack
  rake spec
  git add vendor/gems/haml-2.0.9
  git add config/environment.rb

  # Wikitext 1.5.0 update
  sudo gem install wikitext
  rake gems:unpack
  git add vendor/gems/wikitext-1.5.0
  rake gems:build
  git rm -r vendor/gems/wikitext-1.4.1
  rm -r vendor/gems/wikitext-1.4.1
  git add vendor/gems/wikitext-1.5.0/ext/wikitext.bundle
  rm vendor/gems/wikitext-1.5.0/ext/*.o
  rm vendor/gems/wikitext-1.5.0/ext/Makefile
  rm vendor/gems/wikitext-1.5.0/ext/mkmf.log

  # Rails 2.3.1 RC2 update
  sudo gem install rails --source http://gems.rubyonrails.org
  rake rails:freeze:gems
  rake rails:update
  (cd .. && rails src)
  rake spec

  # Rails 2.3.2 (final) update
  sudo gem install rails
  rake rails:freeze:gems
  rake rails:update
  (cd .. && rails src)
  rake spec

  # RSpec 1.2.0 update
  sudo gem install rspec-rails # also installs rspec (dependency)
  git rm -r vendor/gems/dchelimsky-rspec-1.1.99.7 vendor/gems/dchelimsky-rspec-rails-1.1.99.7
  rm -r vendor/gems/dchelimsky-rspec-1.1.99.7 vendor/gems/dchelimsky-rspec-rails-1.1.99.7 # Git doesn't remove empty dirs
  RAILS_ENV=test rake:gems:unpack # no longer need to unpack dependencies as well
  git add vendor/gems/rspec-1.2.0 vendor/gems/rspec-rails-1.2.0
  script/generate rspec
  rake spec

  # Wikitext 1.5.1 update
  sudo gem install wikitext
  rake gems:unpack
  git add vendor/gems/wikitext-1.5.1

  # NOTE: due to Rails bug #2266, the standard procedure doesn't work:
  # http://rails.lighthouseapp.com/projects/8994/tickets/2266
  #rake gems:build
  # must instead do:
  cp /Library/Ruby/Gems/1.8/gems/wikitext-1.5.1/ext/wikitext.bundle vendor/gems/wikitext-1.5.1/ext/
  # evidently, this makes automated deployment via Capistrano impossible for now

  # now we proceed with the rest of the process:
  git rm -r vendor/gems/wikitext-1.5.0
  rm -r vendor/gems/wikitext-1.5.0
  git add vendor/gems/wikitext-1.5.1/ext/wikitext.bundle

  # this step which we usually need obviously isn't necessary:
  #rm vendor/gems/wikitext-1.5.1/ext/*.o \
  #   vendor/gems/wikitext-1.5.1/ext/Makefile \
  #   vendor/gems/wikitext-1.5.1/ext/mkmf.log

  # RSpec 1.2.2 update
  sudo gem install rspec-rails
  git rm -r vendor/gems/rspec*
  rm -r vendor/gems/rspec*
  RAILS_ENV=test rake gems:unpack
  git add vendor/gems/rspec*
  script/generate rspec
  rake spec

  # RSpec 1.2.3/1.2.4 update
  sudo gem install rspec-rails # this is 1.2.3
  git rm -r vendor/gems/rspec*
  rm -r vendor/gems/rspec*
  vim config/environments/test.rb # update config.gem lines
  RAILS_ENV=test rake gems:unpack
  git add vendor/gems/rspec*
  script/generate rspec
  rake spec # fails because 1.2.3 is broken
  sudo gem install rspec-rails # this is 1.2.4
  git rm -r vendor/gems/rspec*
  rm -r vendor/gems/rspec*
  vim config/environments/test.rb # update config.gem lines
  RAILS_ENV=test rake gems:unpack
  git add vendor/gems/rspec*
  script/generate rspec
  rake spec

  # Wikitext 1.5.3 update
  git rm -r vendor/gems/wikitext-1.5.2
  rm -r vendor/gems/wikitext-1.5.2
  sudo gem install wikitext
  vim config/environment.rb # update config.gem line
  rake gems:unpack
  git add vendor/gems/wikitext-1.5.3
  rake gems:build
  git add vendor/gems/wikitext-1.5.3/ext/wikitext.bundle
  rm vendor/gems/wikitext-1.5.3/ext/Makefile
  rm vendor/gems/wikitext-1.5.3/ext/*.{o,log}

  # RSpec 1.2.5 update
  sudo gem install rspec-rails
  git rm -r vendor/gems/rspec*
  rm -r vendor/gems/rspec*
  vim config/environments/test.rb # update config.gem line
  RAILS_ENV=test rake gems:unpack
  git add vendor/gems/rspec*
  script/generate rspec
  git add lib/tasks/rspec.rake
  rake spec
  cucumber

  # Cucumber 0.3.1 update
  sudo gem install cucumber
  script/generate cucumber
  cucumber

  # RSpec 1.2.6 update
  sudo gem install rspec-rails
  git rm -r vendor/gems/rspec*
  rm -r vendor/gems/rspec*
  vim config/environments/test.rb # update config.gem lines
  RAILS_ENV=test rake gems:unpack
  git add vendor/gems/rspec*
  script/generate rspec
  git add lib/tasks/rspec.rake
  git patch config/environments/test.rb
  rake spec
  cucumber

  # Wikitext 1.6 update
  git rm -r vendor/gems/wikitext-1.5.3
  rm -r vendor/gems/wikitext-1.5.3
  sudo gem install wikitext
  vim config/environment.rb # update config.gem line
  rake gems:unpack
  git add vendor/gems/wikitext-1.6
  rake gems:build
  git add vendor/gems/wikitext-1.6/ext/wikitext.bundle
  rm vendor/gems/wikitext-1.6/ext/Makefile
  rm vendor/gems/wikitext-1.6/ext/*.{o,log}

  # Wikitext 1.8 update (didn't document 1.7 update)
  git rm -r vendor/gems/wikitext-1.7
  rm -r vendor/gems/wikitext-1.7
  sudo gem install wikitext
  vim config/environment.rb # update config.gem line
  rake gems:unpack
  git add vendor/gems/wikitext-1.8
  rake gems:build
  git add vendor/gems/wikitext-1.8/ext/wikitext.bundle
  rm vendor/gems/wikitext-1.8/ext/Makefile
  rm vendor/gems/wikitext-1.8/ext/*.{o,log}

  # RSpec 1.2.7/rspec-rails 1.2.7.1 update
  sudo gem install rspec-rails
  git rm -r vendor/gems/rspec*
  rm -r vendor/gems/rspec*
  vim config/environments/test.rb # update config.gem lines
  RAILS_ENV=test rake gems:unpack
  git add vendor/gems/rspec*
  script/generate rspec
  git add lib/tasks/rspec.rake spec/rcov.opts
  git patch config/environments/test.rb
  rake spec
  cucumber

  # Haml 2.2.0 update
  sudo gem install --no-ri haml
  git rm -r vendor/gems/haml-2.0.9 # doesn't actually delete directory
  rm -r vendor/gems/haml-2.0.9     # so must delete that manually
  vi config/environment.rb         # update config.gem line
  rake gems
  rake gems:unpack
  rake spec
  git add vendor/gems/haml-2.2.0
  git add config/environment.rb
  git add doc/SETUP_NOTES

  # Haml 2.2.1 update
  sudo gem install --no-ri haml
  git rm -r vendor/gems/haml-2.2.0 # doesn't actually delete directory
  rm -r vendor/gems/haml-2.2.0     # so must delete that manually
  vi config/environment.rb         # update config.gem line
  rake gems
  rake gems:unpack
  rake spec
  git add vendor/gems/haml-2.2.1
  git add config/environment.rb
  git add doc/SETUP_NOTES
