var global_pending_lightbox_image=null;function lightbox(g){var e=$(g).parent();e.wrap('<div class="lightbox-wrapper"></div>');e.prepend('<img class="widget expand" alt="expand" title="Click to enlarge" src="/images/dashboard-expand.png" />');e.mouseenter(function(){if(g.fullsized){return}var h=$("<img />").attr("src",e.attr("href"));h.thumbnail=$(g);h.attr("title",h.thumbnail.attr("title"));$(h).load(function(){h.loaded=true;if(global_pending_lightbox_image==h){a(h)}});g.fullsized=h});var d=function(h){b();if(h.data.tag.fullsized.loaded){a(h.data.tag.fullsized)}else{f();global_pending_lightbox_image=h.data.tag.fullsized}return false};e.bind("click",{tag:g},d);function a(o){$("#lightbox-spinner-frame").hide();if($("#lightbox-image-frame").length==0){$("#content").prepend($('<div id="lightbox-image-frame"><a href="#" title="Click to dismiss" onclick="return false;"><img class="widget close" src="/images/dashboard-close.png" /></a><div id="lightbox-caption"></div></div>').append(o).click(function(){$("#lightbox-image-frame").fadeOut("def");c()}))}else{$("#lightbox-image-frame").find("img").not(".widget").remove();$("#lightbox-image-frame").append(o)}$("#lightbox-caption").html(o.attr("title"));var q=o.thumbnail.offset();var j=q.top+o.thumbnail.height()/2;var k=j-(o[0].height/2);if(k+o[0].height+20>$(document).height()){k=$(document).height()-(o[0].height+85)}if(k<25){k=25}var m=($(document).width()/2)-(o[0].width/2);if(m<25){m=25}$("#lightbox-image-frame").css("top",k+"px").css("left",m+"px").fadeIn("def");var r=window.innerWidth;var h=window.innerHeight;var p=window.pageXOffset;var n=window.pageYOffset;if(typeof r=="undefined"||typeof h=="undefined"||typeof p=="undefined"||typeof n=="undefined"){return}var l=m+o[0].width/2;var i=k+o[0].height/2;var t=p+r/2;var s=n+h/2;p-=t-l;n-=s-i;if(p<0){p=0}else{if(p+r>$(document).width()){p=$(document).width()-r}}if(n<0){n=0}else{if(n+h>$(document).height()){n=$(document).height()-h}}window.scrollTo(p,n)}function f(){if($("#lightbox-spinner-frame").length==0){$(document.body).append($('<div id="lightbox-spinner-frame"><img id="lightbox-spinner" alt="spinner" src="/images/spinner-large.gif" /></div>'))}$("#lightbox-spinner-frame").show()}function b(){$(".widget.expand").each(function(){$(this).removeClass("opaque").addClass("translucent")});$(".lightbox").each(function(){$(this).parent().unbind("click").click(function(){return false})})}function c(){$(".widget.expand").each(function(){$(this).removeClass("translucent").addClass("opaque")});$(".lightbox").each(function(){$(this).parent().unbind("click").bind("click",{tag:this},d)})}}$(document).ready(function(){$(".lightbox").each(function(){lightbox(this)})});