var global_pending_lightbox_image=null;
function lightbox(b){function p(){$("#lightbox-overlay").length||$("#content").prepend($('<div id="lightbox-overlay"></div>').click(function(){m()}));$("#lightbox-overlay").fadeIn()}function m(){$("#lightbox-overlay").fadeOut("def");$("#lightbox-image-frame").fadeOut("def",function(){$(this).remove()});q()}function k(a,b){$("#lightbox-spinner-frame").hide();p();$("#content").prepend($('<div id="lightbox-image-frame"><a href="#" title="Click to dismiss" onclick="return false;"><img class="widget close" src="/images/dashboard-close.png" /></a></div>').append(a).append('<div id="lightbox-caption"></div>'));(b?
$("#lightbox-image-frame"):$("#lightbox-image-frame").find("a[href=#]")).click(function(){m()});$("#lightbox-caption").html(a.attr("title"));b||$("#lightbox-caption").append('<br /><a href="http://www.apple.com/quicktime/download/"><img src="/images/quicktime.gif"  alt="Get QuickTime"></a>');var h=a.thumbnail.offset().top+a.thumbnail.height()/2,d=$("#lightbox-image-frame").width(),c=$("#lightbox-image-frame").height();h-=c/2;h+c+20>$(document).height()&&(h=$(document).height()-(c+85));h<25&&(h=25);
var e=$(document).width()/2-d/2;e<25&&(e=25);$("#lightbox-image-frame").css("top",h+"px").css("left",e+"px").fadeIn("def");var i=window.innerWidth,j=window.innerHeight,f=window.pageXOffset,g=window.pageYOffset;typeof i=="undefined"||typeof j=="undefined"||typeof f=="undefined"||typeof g=="undefined"||(f-=f+i/2-(e+d/2),g-=g+j/2-(h+c/2),f<0?f=0:f+i>$(document).width()&&(f=$(document).width()-i),g<0?g=0:g+j>$(document).height()&&(g=$(document).height()-j),$("html,body").animate({scrollLeft:f,scrollTop:g},
"slow"))}function r(){$(".widget.expand").each(function(){$(this).removeClass("opaque").addClass("translucent")});$(".lightbox").each(function(){$(this).parent().unbind("click").click(function(){return!1})})}function q(){$(".widget.expand").each(function(){$(this).removeClass("translucent").addClass("opaque")});$(".lightbox").each(function(){$(this).parent().unbind("click").bind("click",{tag:this},n)})}var d=$(b).parent();d.wrap('<div class="lightbox-wrapper"></div>');d.prepend('<img class="widget expand" alt="expand" title="Click to enlarge" src="/images/dashboard-expand.png" />');
var c=d.attr("href");b.image=!c.match(/\.mov(\?.*)?$/);var l={};if(c.match(/(.+)\?(.+)$/))c=RegExp.$1,$.each(RegExp.$2.split("&"),function(a,b){var c=b.split("=");l[c[0]]=c[1]});if(b.image)d.mouseenter(function(){if(!b.fullsized){var a=$("<img />").attr("src",c);a.thumbnail=$(b);a.attr("title",a.thumbnail.attr("title"));$(a).load(function(){a.loaded=!0;global_pending_lightbox_image==a&&k(a,!0)});b.fullsized=a}});else{var e=parseInt(l.width||d.width()),o=parseInt(l.height||d.height())+16;e=$("<object/>",
{classid:"clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B",codebase:"http://www.apple.com/qtactivex/qtplugin.cab",title:$(b).attr("title")}).attr({width:e,height:o}).append($("<param/>",{name:"src",value:c})).append($("<param/>",{name:"autoplay",value:"true"})).append($("<embed/>",{src:c,type:"video/quicktime",autoplay:"true",pluginspage:"http://www.apple.com/quicktime/download/"}).attr({width:e,height:o}));e.thumbnail=$(b);b.fullsized=e}var n=function(a){r();a.data.tag.image?a.data.tag.fullsized.loaded?
k(a.data.tag.fullsized,!0):($("#lightbox-spinner-frame").length==0&&$(document.body).append($('<div id="lightbox-spinner-frame"><img id="lightbox-spinner" alt="spinner" src="/images/spinner-large.gif" /></div>')),$("#lightbox-spinner-frame").show(),global_pending_lightbox_image=a.data.tag.fullsized):k(a.data.tag.fullsized,!1);return!1};d.bind("click",{tag:b},n)}$(document).ready(function(){$(".lightbox").each(function(){lightbox(this)})});
