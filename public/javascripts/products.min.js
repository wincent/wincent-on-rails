var global_pending_lightbox_image=null;
function lightbox(e){function j(a){$("#lightbox-spinner-frame").hide();if($("#lightbox-image-frame").length==0)$("#content").prepend($('<div id="lightbox-image-frame"><a href="#" title="Click to dismiss" onclick="return false;"><img class="widget close" src="/images/dashboard-close.png" /></a><div id="lightbox-caption"></div></div>').append(a).click(function(){$("#lightbox-image-frame").fadeOut("def");l()}));else{$("#lightbox-image-frame").find("img").not(".widget").remove();$("#lightbox-image-frame").append(a)}$("#lightbox-caption").html(a.attr("title"));
var b=a.thumbnail.offset().top+a.thumbnail.height()/2-a[0].height/2;if(b+a[0].height+20>$(document).height())b=$(document).height()-(a[0].height+85);if(b<25)b=25;var g=$(document).width()/2-a[0].width/2;if(g<25)g=25;$("#lightbox-image-frame").css("top",b+"px").css("left",g+"px").fadeIn("def");var h=window.innerWidth,i=window.innerHeight,c=window.pageXOffset,d=window.pageYOffset;if(!(typeof h=="undefined"||typeof i=="undefined"||typeof c=="undefined"||typeof d=="undefined")){b=b+a[0].height/2;var m=
d+i/2;c-=c+h/2-(g+a[0].width/2);d-=m-b;if(c<0)c=0;else if(c+h>$(document).width())c=$(document).width()-h;if(d<0)d=0;else if(d+i>$(document).height())d=$(document).height()-i;$("html,body").animate({scrollLeft:c,scrollTop:d},"slow")}}function n(){$("#lightbox-spinner-frame").length==0&&$(document.body).append($('<div id="lightbox-spinner-frame"><img id="lightbox-spinner" alt="spinner" src="/images/spinner-large.gif" /></div>'));$("#lightbox-spinner-frame").show()}function o(){$(".widget.expand").each(function(){$(this).removeClass("opaque").addClass("translucent")});
$(".lightbox").each(function(){$(this).parent().unbind("click").click(function(){return false})})}function l(){$(".widget.expand").each(function(){$(this).removeClass("translucent").addClass("opaque")});$(".lightbox").each(function(){$(this).parent().unbind("click").bind("click",{tag:this},k)})}var f=$(e).parent();f.wrap('<div class="lightbox-wrapper"></div>');f.prepend('<img class="widget expand" alt="expand" title="Click to enlarge" src="/images/dashboard-expand.png" />');f.mouseenter(function(){if(!e.fullsized){var a=
$("<img />").attr("src",f.attr("href"));a.thumbnail=$(e);a.attr("title",a.thumbnail.attr("title"));$(a).load(function(){a.loaded=true;global_pending_lightbox_image==a&&j(a)});e.fullsized=a}});var k=function(a){o();if(a.data.tag.fullsized.loaded)j(a.data.tag.fullsized);else{n();global_pending_lightbox_image=a.data.tag.fullsized}return false};f.bind("click",{tag:e},k)}$(document).ready(function(){$(".lightbox").each(function(){lightbox(this)})});
