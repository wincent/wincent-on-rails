var global_pending_lightbox_image=null;function lightbox(g){var e=$(g).parent();e.wrap('<div class="lightbox-wrapper"></div>');e.prepend('<img class="widget expand" src="/images/dashboard-expand.png" />');e.mouseenter(function(){if(g.fullsized){return}var h=$("<img />").attr("src",e.attr("href"));h.thumbnail=$(g);$(h).load(function(){h.loaded=true;if(global_pending_lightbox_image==h){a(h)}});g.fullsized=h});var d=function(h){b();if(h.data.tag.fullsized.loaded){a(h.data.tag.fullsized)}else{f();global_pending_lightbox_image=h.data.tag.fullsized}return false};e.bind("click",{tag:g},d);function a(k){$("#lightbox-spinner-frame").hide();if($("#lightbox-image-frame").length==0){$("#content").prepend($('<div id="lightbox-image-frame"><a href="#" title="Click to dismiss" onclick="return false;"><img class="widget close" src="/images/dashboard-close.png" /></a></div>').append(k).click(function(){$("#lightbox-image-frame").fadeOut("def");c()}))}else{$("#lightbox-image-frame").find("img").not(".widget").remove();$("#lightbox-image-frame").append(k)}var i=k.thumbnail.offset();var l=i.top+k.thumbnail.height()/2;var h=l-(k[0].height/2);if(h+k[0].height+20>$(document).height()){h=$(document).height()-(k[0].height+85)}if(h<25){h=25}var j=($(document).width()/2)-(k[0].width/2);if(j<25){j=25}$("#lightbox-image-frame").css("top",h+"px").css("left",j+"px").fadeIn("def")}function f(){if($("#lightbox-spinner-frame").length==0){$(document.body).append($('<div id="lightbox-spinner-frame"><img id="lightbox-spinner" alt="spinner" src="/images/spinner-large.gif" /></div>'))}$("#lightbox-spinner-frame").show()}function b(){$(".widget.expand").each(function(){$(this).removeClass("opaque").addClass("translucent")});$(".lightbox").each(function(){$(this).parent().unbind("click").click(function(){return false})})}function c(){$(".widget.expand").each(function(){$(this).removeClass("translucent").addClass("opaque")});$(".lightbox").each(function(){$(this).parent().unbind("click").bind("click",{tag:this},d)})}}$(document).ready(function(){$(".lightbox").each(function(){lightbox(this)})});