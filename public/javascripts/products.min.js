var global_pending_lightbox_image=null;
function lightbox(g){var h=$(g).parent();h.wrap('<div class="lightbox-wrapper"></div>');h.prepend('<img class="widget expand" alt="expand" title="Click to enlarge" src="/images/dashboard-expand.png" />');h.mouseenter(function(){if(!g.fullsized){var a=$("<img />").attr("src",h.attr("href"));a.thumbnail=$(g);a.attr("title",a.thumbnail.attr("title"));$(a).load(function(){a.loaded=true;global_pending_lightbox_image==a&&j(a)});g.fullsized=a}});function k(a){l();if(a.data.tag.fullsized.loaded)j(a.data.tag.fullsized);else{m();
global_pending_lightbox_image=a.data.tag.fullsized}return false}h.bind("click",{tag:g},k);function j(a){$("#lightbox-spinner-frame").hide();if($("#lightbox-image-frame").length==0)$("#content").prepend($('<div id="lightbox-image-frame"><a href="#" title="Click to dismiss" onclick="return false;"><img class="widget close" src="/images/dashboard-close.png" /></a><div id="lightbox-caption"></div></div>').append(a).click(function(){$("#lightbox-image-frame").fadeOut("def");n()}));else{$("#lightbox-image-frame").find("img").not(".widget").remove();
$("#lightbox-image-frame").append(a)}$("#lightbox-caption").html(a.attr("title"));var b=a.thumbnail.offset();b=b.top+a.thumbnail.height()/2;var c=b-a[0].height/2;if(c+a[0].height+20>$(document).height())c=$(document).height()-(a[0].height+85);if(c<25)c=25;var f=$(document).width()/2-a[0].width/2;if(f<25)f=25;$("#lightbox-image-frame").css("top",c+"px").css("left",f+"px").fadeIn("def");b=window.innerWidth;var i=window.innerHeight,d=window.pageXOffset,e=window.pageYOffset;if(!(typeof b=="undefined"||
typeof i=="undefined"||typeof d=="undefined"||typeof e=="undefined")){f=f+a[0].width/2;a=c+a[0].height/2;c=d+b/2;var o=e+i/2;d-=c-f;e-=o-a;if(d<0)d=0;else if(d+b>$(document).width())d=$(document).width()-b;if(e<0)e=0;else if(e+i>$(document).height())e=$(document).height()-i;$("html,body").animate({scrollLeft:d,scrollTop:e},"slow")}}function m(){$("#lightbox-spinner-frame").length==0&&$(document.body).append($('<div id="lightbox-spinner-frame"><img id="lightbox-spinner" alt="spinner" src="/images/spinner-large.gif" /></div>'));
$("#lightbox-spinner-frame").show()}function l(){$(".widget.expand").each(function(){$(this).removeClass("opaque").addClass("translucent")});$(".lightbox").each(function(){$(this).parent().unbind("click").click(function(){return false})})}function n(){$(".widget.expand").each(function(){$(this).removeClass("translucent").addClass("opaque")});$(".lightbox").each(function(){$(this).parent().unbind("click").bind("click",{tag:this},k)})}}$(document).ready(function(){$(".lightbox").each(function(){lightbox(this)})});
