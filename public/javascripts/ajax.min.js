var global_spinner_counter=0;function escapeHTML(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function insertAJAXFlash(a,b){$("#ajax-flash").append($("<div/>",{"class":a,html:escapeHTML(b)})).show()}function clearAJAXFlash(){$("#ajax-flash").fadeOut("slow",function(){$(this).hide()}).empty()}
function ajax_comment_form(a){var b=$("#comment-form"),e=b.find("a");e.attr("href","#comment-form");var f=function(){e.unbind("click").addClass("disabled");var h=$("<img/>",{alt:"Spinner",id:"spinner_"+global_spinner_counter++,"class":"spinner",src:"/images/spinner.gif"});b.append(h);h.show();clearAJAXFlash();$.ajax({url:a,type:"get",dataType:"html",success:function(a){clearAJAXFlash();b.find(".links").hide();b.append(a)},error:function(a){insertAJAXFlash("error",a.responseText);e.click(f).removeClass("disabled")},
complete:function(){h.remove()}})};e.click(f)}
function edit_in_place(a,b,e,f){$(a).each(function(){function a(){d.addClass("highlight")}function g(){d.removeClass("highlight")}function i(){var c=d.text();d.unbind("mouseenter mouseleave");g();d.attr("title","Click outside to abort editing");d.html('<form action="javascript:void(0)" style="display:inline;"><input type="text" value="'+escapeHTML(c)+'"></form>');d.find("input")[0].select();d.unbind("dblclick");d.find("input").blur(function(){d.text(c);d.dblclick(i);d.hover(a,g)});d.find("form").submit(function(){var c=
d.find("input").val();d.text("saving...");$.ajax({url:f+j,type:"post",dataType:"json",data:"_method=put&"+b+"["+e+"]="+encodeURIComponent(c),success:function(a){d.text(a[b][e]);d.removeClass("ajax_error");clearAJAXFlash()},error:function(a){d.text(c);d.addClass("ajax_error");insertAJAXFlash("error",a.responseText)},complete:function(){d.hover(a,g);d.dblclick(i)}})})}var c=$(this).attr("id"),j=c.match(/_(\d+)$/)[1],d=$("#"+c+"_"+e);d.attr("title","Double-click to edit");d.dblclick(i);d.hover(a,g)})}
function ajax_check_box(a,b,e,f){a=$(a).attr("id");var h=a.match(/_(\d+)$/)[1],g=$("#"+a+"_"+e);a=g.text();var i="spinner_"+global_spinner_counter++;g.html('<input id="'+b+"_"+e+'" name="'+b+"["+e+']" type="checkbox"><img alt="Spinner" id="'+i+'" class="spinner" src="/images/spinner.gif" />');var c=g.find("input");a==="true"&&c.attr("checked","checked");var j=c.attr("checked");c.change(function(){var a=g.find("#"+i);a.show();$.ajax({url:f+h,type:"post",dataType:"json",data:"_method=put&"+b+"["+e+
"]="+c.attr("checked"),success:function(){j=c.attr("checked");clearAJAXFlash()},error:function(a){c.attr("checked",j);insertAJAXFlash("error",a.responseText)},complete:function(){a.hide()}})})}
function ajax_select(a,b,e,f,h,g){function i(a){for(var b="",c=0;c<a.length;c++)d===a[c][0]?(b=b+'<option value="'+a[c][1]+'" selected="selected">'+a[c][0]+"</option>",l=!0):b=b+'<option value="'+a[c][1]+'">'+a[c][0]+"</option>";return b}a=$(a).attr("id");var c=a.match(/_(\d+)$/)[1],j=$("#"+a+"_"+e),d=j.text(),k="spinner_"+global_spinner_counter++;a='<select id="'+b+"_"+e+'" name="'+b+"["+e+']">';h&&(a+='<option value=""></option>');var l=!1;if(f.length>0&&f[0].length>=2&&f[0][1]instanceof Array)for(var m=
0;m<f.length;m++)a=a+'<optgroup label="'+f[m][0]+'">',a+=i(f[m][1]),a+="</optgroup>";else a+=i(f);j.html(a+'</select><img alt="Spinner" id="'+k+'" class= "spinner" src="/images/spinner.gif" />');var n=j.find("select");if(!l)if(h)n.find("option:first").attr("selected","selected");else{alert("failed to find selection");return}var o=j.find("select option:selected").text();n.change(function(){var a=j.find("#"+k);a.show();$.ajax({url:g+c,type:"post",dataType:"json",data:"_method=put&"+b+"["+e+"]="+n.val(),
success:function(){o=j.find("select option:selected").text();clearAJAXFlash()},error:function(a){n.val(o);insertAJAXFlash("error",a.responseText)},complete:function(){a.hide()}})})}
function setup_preview_link(a){$("#preview_link").append('<a href="#"><img src="/images/update.png" alt="refresh" /></a><img id="preview_spinner" src="/images/spinner.gif" alt="spinner" />');$("#preview_link a").click(function(){$("#preview_spinner").show();for(var b=[],e=a.include.length,f=0;f<e;f++){var h=$("#"+a.kind+"_"+a.include[f]).val();b.push(a.include[f]+"="+encodeURIComponent(h))}$.ajax({url:a.url,type:"post",dataType:"html",data:b.join("&"),success:function(a){$("#preview").html(a).syntaxHighlight();
clearAJAXFlash()},error:function(a){insertAJAXFlash("error",a.responseText)},complete:function(){$("#preview_spinner").hide()}});return!1})}
function observe_field(a){var b=a.field||$("#"+a.kind+"_"+a.fieldName),e=(a.interval||30)*1E3,f=a.before||function(){$("#preview_spinner").show()},h=a.success||function(a){$("#preview").html(a).syntaxHighlight();clearAJAXFlash()},g=a.error||function(a){insertAJAXFlash("error",a.responseText)},i=a.complete||function(){$("#preview_spinner").hide()};if(typeof window.observed_field_contents==="undefined")window.observed_field_contents={};window.observed_field_contents[b.attr("id")]=b.val();setInterval(function(){var c=
b.val(),e=window.observed_field_contents[b.attr("id")];if(c!==e){f();e=a.fieldName+"="+encodeURIComponent(c);if(a.include)for(var d=a.include.length,k=0;k<d;k++){var l=$("#"+a.kind+"_"+a.include[k]).val();e+="&"+a.include[k]+"="+encodeURIComponent(l)}$.ajax({url:a.url,type:"post",dataType:"html",data:e,success:function(a){h(a)},error:function(a){g(a)},complete:function(){i();window.observed_field_contents[b.attr("id")]=c}})}},e)};
