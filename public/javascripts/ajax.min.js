var global_spinner_counter=0;function escapeHTML(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function insertAJAXFlash(a,c){$("#ajax-flash").append($("<div/>",{"class":a,html:escapeHTML(c)})).show();alert("worked")}function clearAJAXFlash(){$("#ajax-flash").fadeOut("slow",function(){$("#ajax-flash").hide()})}
function ajax_comment_form(a){var c=$("#comment-form"),d=c.find("a");d.attr("href","#comment-form");function e(){d.unbind("click");var i="spinner_"+global_spinner_counter++;c.append('<img alt="Spinner" id="'+i+'" class="spinner" src="/images/spinner.gif" />');var h=c.find("#"+i);h.show();$.ajax({url:a,type:"get",dataType:"html",success:function(b){clearAJAXFlash();c.html(b)},error:function(b){insertAJAXFlash("error",b.responseText);h.remove();d.click(e)}})}d.click(e)}
function edit_in_place(a,c,d,e){a=$(a);a.each(function(i){i=$(this).attr("id");var h=i.match(/_(\d+)$/)[1],b=$("#"+i+"_"+d);function f(){b.addClass("highlight")}function g(){b.removeClass("highlight")}function l(){var j=b.text();b.unbind("mouseenter mouseleave");g();b.attr("title","Click outside to abort editing");b.html('<form action="javascript:void(0)" style="display:inline;"><input type="text" value="'+escapeHTML(j)+'"></form>');b.find("input")[0].select();b.unbind("dblclick");b.find("input").blur(function(){b.text(j);
b.dblclick(l);b.hover(f,g)});b.find("form").submit(function(){var m=b.find("input").val();b.text("saving...");$.ajax({url:e+h,type:"post",dataType:"json",data:"_method=put&"+c+"["+d+"]="+encodeURIComponent(m),success:function(k){b.text(k[c][d]);b.removeClass("ajax_error");clearAJAXFlash()},error:function(k){b.text(m);b.addClass("ajax_error");insertAJAXFlash("error",k.responseText)},complete:function(){b.hover(f,g);b.dblclick(l)}})})}b.attr("title","Double-click to edit");b.dblclick(l);b.hover(f,g)})}
function ajax_check_box(a,c,d,e){a=$(a).attr("id");var i=a.match(/_(\d+)$/)[1],h=$("#"+a+"_"+d);a=h.text();var b="spinner_"+global_spinner_counter++,f='<input id="'+c+"_"+d+'" name="'+c+"["+d+']" type="checkbox"><img alt="Spinner" id="'+b+'" class="spinner" src="/images/spinner.gif" />';h.html(f);var g=h.find("input");a=="true"&&g.attr("checked","checked");var l=g.attr("checked");g.change(function(){var j=h.find("#"+b);j.show();$.ajax({url:e+i,type:"post",dataType:"json",data:"_method=put&"+c+"["+
d+"]="+g.attr("checked"),success:function(m){l=g.attr("checked");clearAJAXFlash()},error:function(m){g.attr("checked",l);insertAJAXFlash("error",m.responseText)},complete:function(){j.hide()}})})}
function ajax_select(a,c,d,e,i,h){a=$(a).attr("id");var b=a.match(/_(\d+)$/)[1],f=$("#"+a+"_"+d),g=f.text(),l="spinner_"+global_spinner_counter++;a='<select id="'+c+"_"+d+'" name="'+c+"["+d+']">';if(i)a+='<option value=""></option>';var j=false;function m(n){for(var o="",p=0;p<n.length;p++)if(g==n[p][0]){o=o+'<option value="'+n[p][1]+'" selected="selected">'+n[p][0]+"</option>";j=true}else o=o+'<option value="'+n[p][1]+'">'+n[p][0]+"</option>";return o}if(e.length>0&&e[0].length>=2&&e[0][1]instanceof
Array)for(var k=0;k<e.length;k++){a=a+'<optgroup label="'+e[k][0]+'">';a+=m(e[k][1]);a+="</optgroup>"}else a+=m(e);a=a+'</select><img alt="Spinner" id="'+l+'" class= "spinner" src="/images/spinner.gif" />';f.html(a);var q=f.find("select");if(!j)if(i)q.find("option:first").attr("selected","selected");else{alert("failed to find selection");return}var r=f.find("select option:selected").text();q.change(function(){var n=f.find("#"+l);n.show();$.ajax({url:h+b,type:"post",dataType:"json",data:"_method=put&"+
c+"["+d+"]="+q.val(),success:function(o){r=f.find("select option:selected").text();clearAJAXFlash()},error:function(o){q.val(r);insertAJAXFlash("error",o.responseText)},complete:function(){n.hide()}})})}
function setup_preview_link(a){$("#preview_link").append('<a href="#"><img src="/images/update.png" alt="refresh" /></a><img id="preview_spinner" src="/images/spinner.gif" alt="spinner" />');$("#preview_link a").click(function(){$("#preview_spinner").show();for(var c=[],d=a.include.length,e=0;e<d;e++){var i=$("#"+a.kind+"_"+a.include[e]).val();c.push(a.include[e]+"="+encodeURIComponent(i))}$.ajax({url:a.url,type:"post",dataType:"html",data:c.join("&"),success:function(h){$("#preview").html(h);clearAJAXFlash()},
error:function(h){insertAJAXFlash("error",h.responseText)},complete:function(){$("#preview_spinner").hide()}});return false})}
function observe_field(a){var c=a.field||$("#"+a.kind+"_"+a.fieldName),d=(a.interval||30)*1000,e=a.before||function(){$("#preview_spinner").show()},i=a.success||function(f){$("#preview").html(f);clearAJAXFlash()},h=a.error||function(f){insertAJAXFlash("error",f.responseText)},b=a.complete||function(){$("#preview_spinner").hide()};if(typeof window.observed_field_contents=="undefined")window.observed_field_contents={};window.observed_field_contents[c.attr("id")]=c.val();setInterval(function(){var f=
c.val(),g=window.observed_field_contents[c.attr("id")];if(f!=g){e();g=a.fieldName+"="+encodeURIComponent(f);if(a.include)for(var l=a.include.length,j=0;j<l;j++){var m=$("#"+a.kind+"_"+a.include[j]).val();g+="&"+a.include[j]+"="+encodeURIComponent(m)}$.ajax({url:a.url,type:"post",dataType:"html",data:g,success:function(k){i(k)},error:function(k){h(k)},complete:function(){b();window.observed_field_contents[c.attr("id")]=f}})}},d)};
