var global_spinner_counter=0;function escapeHTML(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function insertAJAXFlash(a,b){$("#ajax-flash").html('<div class="'+a+'">'+escapeHTML(b)+"</div>").show()}function clearAJAXFlash(){$("#ajax-flash").fadeOut("slow",function(){$("#ajax-flash").hide()})}function ajax_comment_form(c){var a=$("#comment-form");var b=a.find("a");b.attr("href","#comment-form");var d=function(){b.unbind("click");var f="spinner_"+global_spinner_counter++;a.append('<img alt="Spinner" id="'+f+'" class="spinner" src="/images/spinner.gif" />');var e=a.find("#"+f);e.show();$.ajax({url:c,type:"get",dataType:"html",success:function(g){clearAJAXFlash();a.html(g)},error:function(g){insertAJAXFlash("error",g.responseText);e.remove();b.click(d)}})};b.click(d)}function edit_in_place(a,e,d,c){var b=$(a);b.each(function(h){var m=$(this).attr("id");var g=m.match(/_(\d+)$/)[1];var j=$("#"+m+"_"+d);function f(){j.addClass("highlight")}function l(){j.removeClass("highlight")}function k(){var i=j.text();j.unbind("mouseenter mouseleave");l();j.attr("title","Click outside to abort editing");j.html('<form action="javascript:void(0)" style="display:inline;"><input type="text" value="'+escapeHTML(i)+'"></form>');j.find("input")[0].select();j.unbind("dblclick");j.find("input").blur(function(){j.text(i);j.dblclick(k);j.hover(f,l)});j.find("form").submit(function(){var n=j.find("input").val();j.text("saving...");$.ajax({url:c+g,type:"post",dataType:"json",data:"_method=put&"+e+"["+d+"]="+encodeURIComponent(n),success:function(o){j.text(o[e][d]);j.removeClass("ajax_error");clearAJAXFlash()},error:function(o){j.text(n);j.addClass("ajax_error");insertAJAXFlash("error",o.responseText)},complete:function(){j.hover(f,l);j.dblclick(k)}})})}j.attr("title","Double-click to edit");j.dblclick(k);j.hover(f,l)})}function ajax_check_box(e,f,g,b){var a=$(e).attr("id");var i=a.match(/_(\d+)$/)[1];var l=$("#"+a+"_"+g);var d=l.text();var h="spinner_"+global_spinner_counter++;var c='<input id="'+f+"_"+g+'" name="'+f+"["+g+']" type="checkbox"><img alt="Spinner" id="'+h+'" class="spinner" src="/images/spinner.gif" />';l.html(c);var k=l.find("input");if(d=="true"){k.attr("checked","checked")}var j=k.attr("checked");k.change(function(){var m=l.find("#"+h);m.show();$.ajax({url:b+i,type:"post",dataType:"json",data:"_method=put&"+f+"["+g+"]="+k.attr("checked"),success:function(n){j=k.attr("checked");clearAJAXFlash()},error:function(n){k.attr("checked",j);insertAJAXFlash("error",n.responseText)},complete:function(){m.hide()}})})}function ajax_select(h,j,m,r,l,b){var a=$(h).attr("id");var o=a.match(/_(\d+)$/)[1];var q=$("#"+a+"_"+m);var f=q.text();var n="spinner_"+global_spinner_counter++;var d='<select id="'+j+"_"+m+'" name="'+j+"["+m+']">';if(l){d=d+'<option value=""></option>'}var g=false;function p(u){var s="";for(var t=0;t<u.length;t++){if(f==u[t][0]){s=s+'<option value="'+u[t][1]+'" selected="selected">'+u[t][0]+"</option>";g=true}else{s=s+'<option value="'+u[t][1]+'">'+u[t][0]+"</option>"}}return s}if(r.length>0&&r[0].length>=2&&(r[0][1] instanceof Array)){for(var k=0;k<r.length;k++){d=d+'<optgroup label="'+r[k][0]+'">';d=d+p(r[k][1]);d=d+"</optgroup>"}}else{d=d+p(r)}d=d+'</select><img alt="Spinner" id="'+n+'" class= "spinner" src="/images/spinner.gif" />';q.html(d);var e=q.find("select");if(!g){if(!l){alert("failed to find selection");return}else{e.find("option:first").attr("selected","selected")}}var c=q.find("select option:selected").text();e.change(function(){var i=q.find("#"+n);i.show();$.ajax({url:b+o,type:"post",dataType:"json",data:"_method=put&"+j+"["+m+"]="+e.val(),success:function(s){c=q.find("select option:selected").text();clearAJAXFlash()},error:function(s){e.val(c);insertAJAXFlash("error",s.responseText)},complete:function(){i.hide()}})})}function setup_preview_link(a){$("#preview_link").append('<a href="#"><img src="/images/update.png" alt="refresh" /></a><img id="preview_spinner" src="/images/spinner.gif" alt="spinner" />');$("#preview_link a").click(function(){$("#preview_spinner").show();var d=[];var b=a.include.length;for(var c=0;c<b;c++){var e=$("#"+a.kind+"_"+a.include[c]).val();d.push(a.include[c]+"="+encodeURIComponent(e))}$.ajax({url:a.url,type:"post",dataType:"html",data:d.join("&"),success:function(f){$("#preview").html(f);clearAJAXFlash()},error:function(f){insertAJAXFlash("error",f.responseText)},complete:function(){$("#preview_spinner").hide()}});return false})}function observe_field(d){var f=d.field||$("#"+d.kind+"_"+d.fieldName);var b=(d.interval||30)*1000;var e=d.before||function(){$("#preview_spinner").show()};var g=d.success||function(h){$("#preview").html(h);clearAJAXFlash()};var c=d.error||function(h){insertAJAXFlash("error",h.responseText)};var a=d.complete||function(){$("#preview_spinner").hide()};if(typeof window.observed_field_contents=="undefined"){window.observed_field_contents={}}window.observed_field_contents[f.attr("id")]=f.val();setInterval(function(){var n=f.val();var l=window.observed_field_contents[f.attr("id")];if(n!=l){e();var k=d.fieldName+"="+encodeURIComponent(n);if(d.include){var h=d.include.length;for(var j=0;j<h;j++){var m=$("#"+d.kind+"_"+d.include[j]).val();k+="&"+d.include[j]+"="+encodeURIComponent(m)}}$.ajax({url:d.url,type:"post",dataType:"html",data:k,success:function(i){g(i)},error:function(i){c(i)},complete:function(){a();window.observed_field_contents[f.attr("id")]=n}})}},b)};