var global_spinner_counter=0;function escapeHTML(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function insertAJAXFlash(a,b){$("#ajax-flash").append($("<div/>",{"class":a,html:escapeHTML(b)})).show()}function clearAJAXFlash(){$("#ajax-flash").fadeOut("slow",function(){$(this).hide()}).empty()}
function ajax_comment_form(a){var b=$("#comment-form"),c=b.find("a");c.attr("href","#comment-form");var f=function(){c.unbind("click");c.addClass("disabled");var h="spinner_"+global_spinner_counter++;b.append('<img alt="Spinner" id="'+h+'" class="spinner" src="/images/spinner.gif" />');var g=b.find("#"+h);g.show();clearAJAXFlash();$.ajax({url:a,type:"get",dataType:"html",success:function(a){clearAJAXFlash();b.html(a)},error:function(a){insertAJAXFlash("error",a.responseText);g.remove();c.click(f);
c.removeClass("disabled")}})};c.click(f)}
function edit_in_place(a,b,c,f){$(a).each(function(){function a(){e.addClass("highlight")}function g(){e.removeClass("highlight")}function i(){var d=e.text();e.unbind("mouseenter mouseleave");g();e.attr("title","Click outside to abort editing");e.html('<form action="javascript:void(0)" style="display:inline;"><input type="text" value="'+escapeHTML(d)+'"></form>');e.find("input")[0].select();e.unbind("dblclick");e.find("input").blur(function(){e.text(d);e.dblclick(i);e.hover(a,g)});e.find("form").submit(function(){var d=
e.find("input").val();e.text("saving...");$.ajax({url:f+j,type:"post",dataType:"json",data:"_method=put&"+b+"["+c+"]="+encodeURIComponent(d),success:function(a){e.text(a[b][c]);e.removeClass("ajax_error");clearAJAXFlash()},error:function(a){e.text(d);e.addClass("ajax_error");insertAJAXFlash("error",a.responseText)},complete:function(){e.hover(a,g);e.dblclick(i)}})})}var d=$(this).attr("id"),j=d.match(/_(\d+)$/)[1],e=$("#"+d+"_"+c);e.attr("title","Double-click to edit");e.dblclick(i);e.hover(a,g)})}
function ajax_check_box(a,b,c,f){a=$(a).attr("id");var h=a.match(/_(\d+)$/)[1],g=$("#"+a+"_"+c);a=g.text();var i="spinner_"+global_spinner_counter++;g.html('<input id="'+b+"_"+c+'" name="'+b+"["+c+']" type="checkbox"><img alt="Spinner" id="'+i+'" class="spinner" src="/images/spinner.gif" />');var d=g.find("input");a==="true"&&d.attr("checked","checked");var j=d.attr("checked");d.change(function(){var a=g.find("#"+i);a.show();$.ajax({url:f+h,type:"post",dataType:"json",data:"_method=put&"+b+"["+c+
"]="+d.attr("checked"),success:function(){j=d.attr("checked");clearAJAXFlash()},error:function(a){d.attr("checked",j);insertAJAXFlash("error",a.responseText)},complete:function(){a.hide()}})})}
function ajax_select(a,b,c,f,h,g){function i(a){for(var b="",d=0;d<a.length;d++)e===a[d][0]?(b=b+'<option value="'+a[d][1]+'" selected="selected">'+a[d][0]+"</option>",l=!0):b=b+'<option value="'+a[d][1]+'">'+a[d][0]+"</option>";return b}a=$(a).attr("id");var d=a.match(/_(\d+)$/)[1],j=$("#"+a+"_"+c),e=j.text(),k="spinner_"+global_spinner_counter++;a='<select id="'+b+"_"+c+'" name="'+b+"["+c+']">';h&&(a+='<option value=""></option>');var l=!1;if(f.length>0&&f[0].length>=2&&f[0][1]instanceof Array)for(var m=
0;m<f.length;m++)a=a+'<optgroup label="'+f[m][0]+'">',a+=i(f[m][1]),a+="</optgroup>";else a+=i(f);j.html(a+'</select><img alt="Spinner" id="'+k+'" class= "spinner" src="/images/spinner.gif" />');var n=j.find("select");if(!l)if(h)n.find("option:first").attr("selected","selected");else{alert("failed to find selection");return}var o=j.find("select option:selected").text();n.change(function(){var a=j.find("#"+k);a.show();$.ajax({url:g+d,type:"post",dataType:"json",data:"_method=put&"+b+"["+c+"]="+n.val(),
success:function(){o=j.find("select option:selected").text();clearAJAXFlash()},error:function(a){n.val(o);insertAJAXFlash("error",a.responseText)},complete:function(){a.hide()}})})}
function setup_preview_link(a){$("#preview_link").append('<a href="#"><img src="/images/update.png" alt="refresh" /></a><img id="preview_spinner" src="/images/spinner.gif" alt="spinner" />');$("#preview_link a").click(function(){$("#preview_spinner").show();for(var b=[],c=a.include.length,f=0;f<c;f++){var h=$("#"+a.kind+"_"+a.include[f]).val();b.push(a.include[f]+"="+encodeURIComponent(h))}$.ajax({url:a.url,type:"post",dataType:"html",data:b.join("&"),success:function(a){$("#preview").html(a).syntaxHighlight();
clearAJAXFlash()},error:function(a){insertAJAXFlash("error",a.responseText)},complete:function(){$("#preview_spinner").hide()}});return!1})}
function observe_field(a){var b=a.field||$("#"+a.kind+"_"+a.fieldName),c=(a.interval||30)*1E3,f=a.before||function(){$("#preview_spinner").show()},h=a.success||function(a){$("#preview").html(a).syntaxHighlight();clearAJAXFlash()},g=a.error||function(a){insertAJAXFlash("error",a.responseText)},i=a.complete||function(){$("#preview_spinner").hide()};if(typeof window.observed_field_contents==="undefined")window.observed_field_contents={};window.observed_field_contents[b.attr("id")]=b.val();setInterval(function(){var d=
b.val(),c=window.observed_field_contents[b.attr("id")];if(d!==c){f();c=a.fieldName+"="+encodeURIComponent(d);if(a.include)for(var e=a.include.length,k=0;k<e;k++){var l=$("#"+a.kind+"_"+a.include[k]).val();c+="&"+a.include[k]+"="+encodeURIComponent(l)}$.ajax({url:a.url,type:"post",dataType:"html",data:c,success:function(a){h(a)},error:function(a){g(a)},complete:function(){i();window.observed_field_contents[b.attr("id")]=d}})}},c)};
