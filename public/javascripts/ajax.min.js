var global_spinner_counter=0;function escapeHTML(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function insertAJAXFlash(a,c){$("#ajax-flash").append($("<div/>",{"class":a,html:escapeHTML(c)})).show()}function clearAJAXFlash(){$("#ajax-flash").fadeOut("slow",function(){$(this).hide()}).empty()}
function ajax_comment_form(a){var c=$("#comment-form"),d=c.find("a");d.attr("href","#comment-form");var e=function(){d.unbind("click");var j="spinner_"+global_spinner_counter++;c.append('<img alt="Spinner" id="'+j+'" class="spinner" src="/images/spinner.gif" />');var g=c.find("#"+j);g.show();$.ajax({url:a,type:"get",dataType:"html",success:function(h){clearAJAXFlash();c.html(h)},error:function(h){insertAJAXFlash("error",h.responseText);g.remove();d.click(e)}})};d.click(e)}
function edit_in_place(a,c,d,e){$(a).each(function(j){function g(){b.addClass("highlight")}function h(){b.removeClass("highlight")}function f(){var k=b.text();b.unbind("mouseenter mouseleave");h();b.attr("title","Click outside to abort editing");b.html('<form action="javascript:void(0)" style="display:inline;"><input type="text" value="'+escapeHTML(k)+'"></form>');b.find("input")[0].select();b.unbind("dblclick");b.find("input").blur(function(){b.text(k);b.dblclick(f);b.hover(g,h)});b.find("form").submit(function(){var o=
b.find("input").val();b.text("saving...");$.ajax({url:e+i,type:"post",dataType:"json",data:"_method=put&"+c+"["+d+"]="+encodeURIComponent(o),success:function(l){b.text(l[c][d]);b.removeClass("ajax_error");clearAJAXFlash()},error:function(l){b.text(o);b.addClass("ajax_error");insertAJAXFlash("error",l.responseText)},complete:function(){b.hover(g,h);b.dblclick(f)}})})}j=$(this).attr("id");var i=j.match(/_(\d+)$/)[1],b=$("#"+j+"_"+d);b.attr("title","Double-click to edit");b.dblclick(f);b.hover(g,h)})}
function ajax_check_box(a,c,d,e){a=$(a).attr("id");var j=a.match(/_(\d+)$/)[1],g=$("#"+a+"_"+d);a=g.text();var h="spinner_"+global_spinner_counter++;g.html('<input id="'+c+"_"+d+'" name="'+c+"["+d+']" type="checkbox"><img alt="Spinner" id="'+h+'" class="spinner" src="/images/spinner.gif" />');var f=g.find("input");a=="true"&&f.attr("checked","checked");var i=f.attr("checked");f.change(function(){var b=g.find("#"+h);b.show();$.ajax({url:e+j,type:"post",dataType:"json",data:"_method=put&"+c+"["+d+"]="+
f.attr("checked"),success:function(k){i=f.attr("checked");clearAJAXFlash()},error:function(k){f.attr("checked",i);insertAJAXFlash("error",k.responseText)},complete:function(){b.hide()}})})}
function ajax_select(a,c,d,e,j,g){function h(m){for(var n="",p=0;p<m.length;p++)if(b==m[p][0]){n=n+'<option value="'+m[p][1]+'" selected="selected">'+m[p][0]+"</option>";o=true}else n=n+'<option value="'+m[p][1]+'">'+m[p][0]+"</option>";return n}a=$(a).attr("id");var f=a.match(/_(\d+)$/)[1],i=$("#"+a+"_"+d),b=i.text(),k="spinner_"+global_spinner_counter++;a='<select id="'+c+"_"+d+'" name="'+c+"["+d+']">';if(j)a+='<option value=""></option>';var o=false;if(e.length>0&&e[0].length>=2&&e[0][1]instanceof
Array)for(var l=0;l<e.length;l++){a=a+'<optgroup label="'+e[l][0]+'">';a+=h(e[l][1]);a+="</optgroup>"}else a+=h(e);a=a+'</select><img alt="Spinner" id="'+k+'" class= "spinner" src="/images/spinner.gif" />';i.html(a);var q=i.find("select");if(!o)if(j)q.find("option:first").attr("selected","selected");else{alert("failed to find selection");return}var r=i.find("select option:selected").text();q.change(function(){var m=i.find("#"+k);m.show();$.ajax({url:g+f,type:"post",dataType:"json",data:"_method=put&"+
c+"["+d+"]="+q.val(),success:function(n){r=i.find("select option:selected").text();clearAJAXFlash()},error:function(n){q.val(r);insertAJAXFlash("error",n.responseText)},complete:function(){m.hide()}})})}
function setup_preview_link(a){$("#preview_link").append('<a href="#"><img src="/images/update.png" alt="refresh" /></a><img id="preview_spinner" src="/images/spinner.gif" alt="spinner" />');$("#preview_link a").click(function(){$("#preview_spinner").show();for(var c=[],d=a.include.length,e=0;e<d;e++){var j=$("#"+a.kind+"_"+a.include[e]).val();c.push(a.include[e]+"="+encodeURIComponent(j))}$.ajax({url:a.url,type:"post",dataType:"html",data:c.join("&"),success:function(g){$("#preview").html(g);stylePreBlocks();
clearAJAXFlash()},error:function(g){insertAJAXFlash("error",g.responseText)},complete:function(){$("#preview_spinner").hide()}});return false})}
function observe_field(a){var c=a.field||$("#"+a.kind+"_"+a.fieldName),d=(a.interval||30)*1E3,e=a.before||function(){$("#preview_spinner").show()},j=a.success||function(f){$("#preview").html(f);stylePreBlocks();clearAJAXFlash()},g=a.error||function(f){insertAJAXFlash("error",f.responseText)},h=a.complete||function(){$("#preview_spinner").hide()};if(typeof window.observed_field_contents=="undefined")window.observed_field_contents={};window.observed_field_contents[c.attr("id")]=c.val();setInterval(function(){var f=
c.val(),i=window.observed_field_contents[c.attr("id")];if(f!=i){e();i=a.fieldName+"="+encodeURIComponent(f);if(a.include)for(var b=a.include.length,k=0;k<b;k++){var o=$("#"+a.kind+"_"+a.include[k]).val();i+="&"+a.include[k]+"="+encodeURIComponent(o)}$.ajax({url:a.url,type:"post",dataType:"html",data:i,success:function(l){j(l)},error:function(l){g(l)},complete:function(){h();window.observed_field_contents[c.attr("id")]=f}})}},d)};
