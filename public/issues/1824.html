<!DOCTYPE html>
<html lang='en-US'>
<head>
<meta content='text/html;charset=UTF-8' http-equiv='Content-Type'>
<meta content='width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no' name='viewport'>
<title>
Feature request #1824: Update to Rails 3.0.9, and Rails 3.1.0.rc4
&middot; wincent.com
</title>
<link rel="stylesheet" media="screen" href="https://djfaa0bz60cz6.cloudfront.net/assets/application-73fd7b8197d0b27a25f03f916460e23c.css" />
<script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-35574060-1']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</head>
<body>
<div class='viewport menu-closed'>
<div class='app'>
<a id="top" name="top"></a>
<nav class='global'>
<a class='menu-icon' href='#'>&equiv;</a>
<h1><a href="/">Wincent</a></h1>
<ul class='navbar-links'>
<li>
<a href="/products">Products</a>
</li>
<li><a href="/blog">Blog</a></li>
<li><a href="/wiki">Wiki</a></li>
<li class='selected'><a href="/issues">Issues</a></li>
</ul>
</nav>
<div id='content-wrapper'>
<div id='content'>
<div class='notice'>
<i class='fa fa-info-circle'></i>
You are viewing an historical archive of past issues. Please report new issues to the appropriate project issue tracker on <a href="https://github.com/wincent?tab=repositories">GitHub</a>.
</div>
<div id="breadcrumbs"><a href="/">Home</a> &raquo; <a href="/issues">Issues</a> &raquo; Feature request #1824</div>
<div class='issue' id='issue_1824'>
<form class="edit_issue" id="edit_issue_1824" action="/issues/1824" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="_method" value="patch" /><input type="hidden" name="authenticity_token" value="SM/WuEykP0+qbos4wpHYrEGDGhr3MzTBtzBugzGCQsl8PWgP6ynlGnPiuM/zuIsY9AFzJvzfut2XL7t9FVol7Q==" /><input type="text" name="website_address" id="website_address" value="" class="website-address" /><h1 class='feature-request major'>
Feature request #1824:
<span data-name='issue[summary]'>
Update to Rails 3.0.9, and Rails 3.1.0.rc4
</span>
</h1>
<table class='issue-metadata'>
<tr>
<th>Kind</th>
<td>
feature request
</td>
</tr>
<tr>
<th>Product</th>
<td>
wincent.com
</td>
</tr>
<tr>
<th>When</th>
<td>Created <time data-relative="true">2011-05-31T16:35:11Z</time>, updated <time data-relative="true">2011-09-02T06:42:33Z</time></td>
</tr>
<tr>
<th>Status</th>
<td>
closed
</td>
</tr>
<tr>
<th>Reporter</th>
<td><a href="/users/greg-hurrell">Greg Hurrell</a></td>
</tr>
<tr>
<th>Tags</th>
<td data-name='issue[pending_tags]'>
no tags
</td>
</tr>
</table>
<h4 class='major'>
Description
</h4>
<div class='issue-description-body'>
<p>Unless 3.1.0 goes final first...</p>

</div>
</form></div>
<h4 class='major'>Comments</h4>
<ol class='boxed' id='comments'>
<li class='comment admin' id='comment_6903'>
<cite>
<a href="/users/greg-hurrell">Greg Hurrell</a>
<span class='when'><a href="#comment_6903"><time data-relative="true">2011-05-31T16:35:25Z</time></a></span>
</cite>
<blockquote><p><strong>Status</strong> changed:</p>
<ul>
<li><strong>From:</strong> new</li>
<li><strong>To:</strong> open</li>
</ul>
</blockquote>
</li>
<li class='comment admin' id='comment_6904'>
<cite>
<a href="/users/greg-hurrell">Greg Hurrell</a>
<span class='when'><a href="#comment_6904"><time data-relative="true">2011-05-31T18:38:11Z</time></a></span>
</cite>
<blockquote><p>rc3 is a lemon, so wait for rc4 instead:</p>
<ul>
<li><a href="https://github.com/rails/rails/commit/ce23c6e47f184616c8cc9b779c1670e1417adfd0" class="external">https://github.com/rails/rails/commit/ce23c6e47f184616c8cc9b779c1670e1417adfd0</a></li>
</ul>
</blockquote>
</li>
<li class='comment admin' id='comment_6905'>
<cite>
<a href="/users/greg-hurrell">Greg Hurrell</a>
<span class='when'><a href="#comment_6905"><time data-relative="true">2011-05-31T18:38:18Z</time></a></span>
</cite>
<blockquote><p><strong>Summary</strong> changed:</p>
<ul>
<li><strong>From:</strong> Trial Rails 3.0.8.rc3</li>
<li><strong>To:</strong> Trial Rails 3.0.8.rc4</li>
</ul>
</blockquote>
</li>
<li class='comment admin' id='comment_6915'>
<cite>
<a href="/users/greg-hurrell">Greg Hurrell</a>
<span class='when'><a href="#comment_6915"><time data-relative="true">2011-06-08T03:55:52Z</time></a></span>
</cite>
<blockquote><p><strong>Summary</strong> changed:</p>
<ul>
<li><strong>From:</strong> Trial Rails 3.0.8.rc4</li>
<li><strong>To:</strong> Update to Rails 3.0.8, and Rails 3.1.0.rc2</li>
</ul>
</blockquote>
</li>
<li class='comment admin' id='comment_6916'>
<cite>
<a href="/users/greg-hurrell">Greg Hurrell</a>
<span class='when'><a href="#comment_6916"><time data-relative="true">2011-06-08T03:56:35Z</time></a></span>
</cite>
<blockquote><p>3.0.8 final is now out, with a security fix. 3.1.0.rc2 is also out, containing the same fix.</p>
<pre># Potential XSS Vulnerability in Ruby on Rails Applications

The XSS prevention support in recent versions Ruby on Rails allows some string operations which, when combined with user supplied data, may leave an 'unsafe string' incorrectly considered safe.  It is unlikely that applications call these methods, however we are shipping new versions today which prevent their use to ensure they're not called unintentionally.

## How the XSS Prevention Works

When strings are rendered to the client, if the string is not marked as &quot;html safe&quot;, the string will be automatically escaped and marked as &quot;html safe&quot;. Some helper methods automatically return strings already marked as safe.

For example:

   &lt;%= link_to('hello world', @user) %&gt;

The `link_to` method will return a string marked as html safe.  Since `link_to` returns an &quot;html safe&quot; string (also known as a safe buffer), the text will be output directly, meaning the user sees a link tag rather than escaped HTML.

## The Problem

Safe buffers are allowed to be mutated in place via methods like `sub!`.  These methods can add unsafe strings to a safe buffer, and the safe buffer will continue to be marked safe.

An example problem would be something like this:

   &lt;%= link_to('hello world', @user).sub!(/hello/, params[:xss])  %&gt;

In the above example, an untrusted string (`params[:xss]`) is added to the safe buffer returned by `link_to`, and the untrusted content is successfully sent to the client without being escaped.  To prevent this from happening `sub!` and other similar methods will now raise an exception when they are called on a safe buffer.

In addition to the in-place versions, some of the versions of these methods which return a copy of the string will incorrectly mark strings as safe.  For example:

   &lt;%= link_to('hello world', @user).sub(/hello/, params[:xss]) %&gt;

The new versions will now ensure that *all* strings returned by these methods on safe buffers are marked unsafe.
## Affected versions

This problem affects all versions of rails: 3.1.0.rc1, 3.0.7, and 2.3.11.

## The Solution

Any methods that mutate the safe buffer without escaping input will now raise
an exception.

If you need to modify a safe buffer, cast it to a Ruby string first by calling
the `to_str` method:

   &lt;%= link_to('hello world', @user).to_str.sub!(/hello/, params[:xss]) %&gt;

## Upgrading

This problem is fixed in Rails 3.1.0.rc2, 3.0.8, and 2.3.12 (with rails_xss) (which will be
released in the next hour).  If for some reason you cannot upgrade your Rails
installation, please apply these patches (also find them attached):


 * [For 3.1.0.rc1](<a href="https://gist.github.com/89d6266cc7875614c5a5" class="external">https://gist.github.com/89d6266cc7875614c5a5</a>) 
 * [For 3.0.7](<a href="https://gist.github.com/b2ceb626fc2bcdfe497f" class="external">https://gist.github.com/b2ceb626fc2bcdfe497f</a>)
 * [For 2.3.11, specifically the rails_xss plugin](<a href="https://gist.github.com/392235903426322e0414" class="external">https://gist.github.com/392235903426322e0414</a>) 

## Thanks

Thanks to Bruno Michel of LinuxFr.org and Brett Valantine who each independently reported the issue to us.</pre>
</blockquote>
</li>
<li class='comment admin' id='comment_6920'>
<cite>
<a href="/users/greg-hurrell">Greg Hurrell</a>
<span class='when'><a href="#comment_6920"><time data-relative="true">2011-06-09T03:50:12Z</time></a></span>
</cite>
<blockquote><p><strong>Summary</strong> changed:</p>
<ul>
<li><strong>From:</strong> Update to Rails 3.0.8, and Rails 3.1.0.rc2</li>
<li><strong>To:</strong> Update to Rails 3.0.8, and Rails 3.1.0.rc3</li>
</ul>
</blockquote>
</li>
<li class='comment admin' id='comment_6921'>
<cite>
<a href="/users/greg-hurrell">Greg Hurrell</a>
<span class='when'><a href="#comment_6921"><time data-relative="true">2011-06-09T03:52:02Z</time></a></span>
</cite>
<blockquote><p><strong>Summary</strong> changed:</p>
<ul>
<li><strong>From:</strong> Update to Rails 3.0.8, and Rails 3.1.0.rc3</li>
<li><strong>To:</strong> Update to Rails 3.0.9.rc1, and Rails 3.1.0.rc3</li>
</ul>
</blockquote>
</li>
<li class='comment admin' id='comment_6922'>
<cite>
<a href="/users/greg-hurrell">Greg Hurrell</a>
<span class='when'><a href="#comment_6922"><time data-relative="true">2011-06-09T03:52:09Z</time></a></span>
</cite>
<blockquote><ul>
<li>Rails 3.1.0.rc3 announcement: <a href="http://weblog.rubyonrails.org/2011/6/8/ann-rails-3-1-0-rc3-has-been-released" class="external">http://weblog.rubyonrails.org/2011/6/8/ann-rails-3-1-0-rc3-has-been-released</a></li>
<li>Rails 3.1.0.rc2 announcement: <a href="http://weblog.rubyonrails.org/2011/6/8/ann-rails-3-1-0-rc2-has-been-released" class="external">http://weblog.rubyonrails.org/2011/6/8/ann-rails-3-1-0-rc2-has-been-released</a></li>
<li>Rails 3.0.9.rc1 announcement: <a href="http://weblog.rubyonrails.org/2011/6/8/ann-rails-3-0-9-rc1-has-been-released" class="external">http://weblog.rubyonrails.org/2011/6/8/ann-rails-3-0-9-rc1-has-been-released</a></li>
<li>Rails 3.0.8 announcement: <a href="http://weblog.rubyonrails.org/2011/6/8/ann-rails-3-0-8-has-been-released" class="external">http://weblog.rubyonrails.org/2011/6/8/ann-rails-3-0-8-has-been-released</a></li>
</ul>
</blockquote>
</li>
<li class='comment admin' id='comment_6927'>
<cite>
<a href="/users/greg-hurrell">Greg Hurrell</a>
<span class='when'><a href="#comment_6927"><time data-relative="true">2011-06-10T08:23:51Z</time></a></span>
</cite>
<blockquote><p>Tried 'em out, but time to try out some more:</p>
<ul>
<li>Rails 3.1.0.rc4 release announcement: <a href="http://weblog.rubyonrails.org/2011/6/9/ann-rails-3-1-0-rc4-has-been-released" class="external">http://weblog.rubyonrails.org/2011/6/9/ann-rails-3-1-0-rc4-has-been-released</a></li>
<li>Rails 3.0.9.rc3 release announcement: <a href="http://weblog.rubyonrails.org/2011/6/9/ann-rails-3-0-9-rc3-has-been-released" class="external">http://weblog.rubyonrails.org/2011/6/9/ann-rails-3-0-9-rc3-has-been-released</a></li>
</ul>
</blockquote>
</li>
<li class='comment admin' id='comment_6928'>
<cite>
<a href="/users/greg-hurrell">Greg Hurrell</a>
<span class='when'><a href="#comment_6928"><time data-relative="true">2011-06-10T08:24:05Z</time></a></span>
</cite>
<blockquote><p><strong>Summary</strong> changed:</p>
<ul>
<li><strong>From:</strong> Update to Rails 3.0.9.rc1, and Rails 3.1.0.rc3</li>
<li><strong>To:</strong> Update to Rails 3.0.9.rc3, and Rails 3.1.0.rc4</li>
</ul>
</blockquote>
</li>
<li class='comment admin' id='comment_6932'>
<cite>
<a href="/users/greg-hurrell">Greg Hurrell</a>
<span class='when'><a href="#comment_6932"><time data-relative="true">2011-06-13T16:53:16Z</time></a></span>
</cite>
<blockquote><p><strong>Summary</strong> changed:</p>
<ul>
<li><strong>From:</strong> Update to Rails 3.0.9.rc3, and Rails 3.1.0.rc4</li>
<li><strong>To:</strong> Update to Rails 3.0.9.rc5, and Rails 3.1.0.rc4</li>
</ul>
</blockquote>
</li>
<li class='comment admin' id='comment_6936'>
<cite>
<a href="/users/greg-hurrell">Greg Hurrell</a>
<span class='when'><a href="#comment_6936"><time data-relative="true">2011-06-16T16:25:12Z</time></a></span>
</cite>
<blockquote><p><strong>Summary</strong> changed:</p>
<ul>
<li><strong>From:</strong> Update to Rails 3.0.9.rc5, and Rails 3.1.0.rc4</li>
<li><strong>To:</strong> Update to Rails 3.0.9, and Rails 3.1.0.rc4</li>
</ul>
</blockquote>
</li>
<li class='comment admin' id='comment_6937'>
<cite>
<a href="/users/greg-hurrell">Greg Hurrell</a>
<span class='when'><a href="#comment_6937"><time data-relative="true">2011-06-16T16:25:15Z</time></a></span>
</cite>
<blockquote><p><a href="http://weblog.rubyonrails.org/2011/6/16/ann-rails-3-0-9-has-been-released" class="external">http://weblog.rubyonrails.org/2011/6/16/ann-rails-3-0-9-has-been-released</a></p>
</blockquote>
</li>
<li class='comment admin' id='comment_7064'>
<cite>
<a href="/users/greg-hurrell">Greg Hurrell</a>
<span class='when'><a href="#comment_7064"><time data-relative="true">2011-09-02T06:42:21Z</time></a></span>
</cite>
<blockquote><p>Superseded by <a href="/issues/1861">ticket #1861</a>.</p>
</blockquote>
</li>
<li class='comment admin' id='comment_7065'>
<cite>
<a href="/users/greg-hurrell">Greg Hurrell</a>
<span class='when'><a href="#comment_7065"><time data-relative="true">2011-09-02T06:42:33Z</time></a></span>
</cite>
<blockquote><p><strong>Status</strong> changed:</p>
<ul>
<li><strong>From:</strong> open</li>
<li><strong>To:</strong> closed</li>
</ul>
</blockquote>
</li>

</ol>
<h5 class='major'>Add a comment</h5>
<p>Comments are now closed for this issue.</p>

</div>
</div>
<footer class='global'>
<ul>
<li><a title="Email me at greg@hurrell.net" class="mailto" href="mailto:greg@hurrell.net">contact</a></li>
<li><a href="/misc/legal">legal</a></li>
</ul>
</footer>
</div>
<div class='menu hide'>
<div class='menu-inner'>
<section>
<h2>Menu</h2>
<ul>
<li><a href="/blog">Blog</a></li>
<li><a href="/wiki">Wiki</a></li>
<li><a href="/issues">Issues</a></li>
<li><a href="/snippets">Snippets</a></li>
</ul>
</section>
</div>
</div>
</div>
<script src="https://djfaa0bz60cz6.cloudfront.net/assets/application-70afe6376892ea318388e4bbb986d5a1.js"></script>

<script>
  new Wincent.Menu();
</script>
</body>
</html>
