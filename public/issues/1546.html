<!DOCTYPE html>
<html lang='en-US'>
<head>
<meta content='text/html;charset=UTF-8' http-equiv='Content-Type'>
<meta content='width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no' name='viewport'>
<title>
Bug #1546: Issue filtering doesn't work when logged in
&middot; wincent.com
</title>
<link rel="stylesheet" media="screen" href="https://djfaa0bz60cz6.cloudfront.net/assets/application-73fd7b8197d0b27a25f03f916460e23c.css" />
<script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-35574060-1']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</head>
<body>
<div class='viewport menu-closed'>
<div class='app'>
<a id="top" name="top"></a>
<nav class='global'>
<a class='menu-icon' href='#'>&equiv;</a>
<h1><a href="/">Wincent</a></h1>
<ul class='navbar-links'>
<li>
<a href="/products">Products</a>
</li>
<li><a href="/blog">Blog</a></li>
<li><a href="/wiki">Wiki</a></li>
<li class='selected'><a href="/issues">Issues</a></li>
</ul>
</nav>
<div id='content-wrapper'>
<div id='content'>
<div class='notice'>
<i class='fa fa-info-circle'></i>
You are viewing an historical archive of past issues. Please report new issues to the appropriate project issue tracker on <a href="https://github.com/wincent?tab=repositories">GitHub</a>.
</div>
<div id="breadcrumbs"><a href="/">Home</a> &raquo; <a href="/issues">Issues</a> &raquo; Bug #1546</div>
<div class='issue' id='issue_1546'>
<form class="edit_issue" id="edit_issue_1546" action="/issues/1546" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="_method" value="patch" /><input type="hidden" name="authenticity_token" value="42o446HbJQPpYlDbhnxmIjlSJmXC9KOMPHZ3sl+cK//XmIZUBlb/VjDuYyy3VTWWjNBPWckYLZAcaaJMe0RM2w==" /><input type="text" name="website_address" id="website_address" value="" class="website-address" /><h1 class='bug major'>
Bug #1546:
<span data-name='issue[summary]'>
Issue filtering doesn't work when logged in
</span>
</h1>
<table class='issue-metadata'>
<tr>
<th>Kind</th>
<td>
bug
</td>
</tr>
<tr>
<th>Product</th>
<td>
wincent.com
</td>
</tr>
<tr>
<th>When</th>
<td>Created <time data-relative="true">2010-04-28T15:06:33Z</time>, updated <time data-relative="true">2010-06-10T06:33:53Z</time></td>
</tr>
<tr>
<th>Status</th>
<td>
closed
</td>
</tr>
<tr>
<th>Reporter</th>
<td><a href="/users/michael-henry">Michael Henry</a></td>
</tr>
<tr>
<th>Tags</th>
<td data-name='issue[pending_tags]'>
no tags
</td>
</tr>
</table>
<h4 class='major'>
Description
</h4>
<div class='issue-description-body'>
<p>Hello, Wincent,</p>
<p>I signed up for an account on wincent.com due to my interest in your Command-T plugin.  When I'm not  logged in, I'm able to use this URL to see issues related only to this plugin: <a href="https://wincent.com/issues?product=Command-T" class="external">https://wincent.com/issues?product=Command-T</a></p>
<p>When I'm logged in and using the same URL as above,  the filtering doesn't seem to work, and I'm presented  with what appear to be issues from all of your products.</p>
<p>I'm using Firefox-3.6.3 on Arch Linux.</p>
<p>Thanks, Michael Henry</p>

</div>
</form></div>
<h4 class='major'>Comments</h4>
<ol class='boxed' id='comments'>
<li class='comment admin' id='comment_5592'>
<cite>
<a href="/users/greg-hurrell">Greg Hurrell</a>
<span class='when'><a href="#comment_5592"><time data-relative="true">2010-04-28T15:39:55Z</time></a></span>
</cite>
<blockquote><p>Thanks a lot for the report. Wouldn't have noticed myself as it works for me when logged in (admin account), and also when not logged in; when I log in on a normal account I can reproduce it.</p>
</blockquote>
</li>
<li class='comment admin' id='comment_5593'>
<cite>
<a href="/users/greg-hurrell">Greg Hurrell</a>
<span class='when'><a href="#comment_5593"><time data-relative="true">2010-04-28T15:42:54Z</time></a></span>
</cite>
<blockquote><p>I notice the same thing happens using the issue search and selecting a product from the pop-up.</p>
<p>Works for admin account and anonymous visitor, but doesn't work for logged-in normal accounts.</p>
<p>Not just on product field either; exactly the same behavior for the status and the kind pop-ups as well.</p>
</blockquote>
</li>
<li class='comment admin' id='comment_5594'>
<cite>
<a href="/users/greg-hurrell">Greg Hurrell</a>
<span class='when'><a href="#comment_5594"><time data-relative="true">2010-04-28T15:56:49Z</time></a></span>
</cite>
<blockquote><p>Ok, think I've found the cause of the bug. It's an operator precedence thing.</p>
<p>The <code>SELECT</code> query that gets built up for admin users ends up including:</p>
<pre>awaiting_moderation = FALSE</pre>
<p>And for anonymous users it ends up being:</p>
<pre>awaiting_moderation = FALSE AND public = TRUE</pre>
<p>While for logged-in, normal users it ends up being:</p>
<pre>awaiting_moderation = FALSE AND public = TRUE OR user_id = 20</pre>
<p>As <code>AND</code> has higher precedence than <code>OR</code>, that's equivalent to:</p>
<pre>(awaiting_moderation = FALSE AND public = TRUE) OR user_id = 20</pre>
<p>When it really should be forced to be the opposite via parentheses:</p>
<pre>awaiting_moderation = FALSE AND (public = TRUE OR user_id = 20)</pre>
<p>That's my hunch, anyway, going to see if I can whip up some failing tests, try out the fix, and see if that makes the tests pass.</p>
<p>I'm in the middle of some rather invasive changes right now (trying out Rails 3), thank goodness Git makes this kind of thing easy (<code>git stash</code>, <code>git rebase</code> etc).</p>
</blockquote>
</li>
<li class='comment admin' id='comment_5667'>
<cite>
<a href="/users/greg-hurrell">Greg Hurrell</a>
<span class='when'><a href="#comment_5667"><time data-relative="true">2010-06-10T06:33:42Z</time></a></span>
</cite>
<blockquote><p>Ok, finally got the Rails 3 stuff under the control (it was painful) to the point where I can look at other bugs. This one is now fixed in the <code>rails3</code> branch, so will get deployed after a lot of testing... (most likely won't deploy a Rails 3 version of the site until Rails 3.0.1 or 3.0.2 has been out in the field for a while).</p>
</blockquote>
</li>
<li class='comment admin' id='comment_5668'>
<cite>
<a href="/users/greg-hurrell">Greg Hurrell</a>
<span class='when'><a href="#comment_5668"><time data-relative="true">2010-06-10T06:33:53Z</time></a></span>
</cite>
<blockquote><p><strong>Status</strong> changed:</p>
<ul>
<li><strong>From:</strong> new</li>
<li><strong>To:</strong> closed</li>
</ul>
</blockquote>
</li>

</ol>
<h5 class='major'>Add a comment</h5>
<p>Comments are now closed for this issue.</p>

</div>
</div>
<footer class='global'>
<ul>
<li><a title="Email me at greg@hurrell.net" class="mailto" href="mailto:greg@hurrell.net">contact</a></li>
<li><a href="/misc/legal">legal</a></li>
</ul>
</footer>
</div>
<div class='menu hide'>
<div class='menu-inner'>
<section>
<h2>Menu</h2>
<ul>
<li><a href="/blog">Blog</a></li>
<li><a href="/wiki">Wiki</a></li>
<li><a href="/issues">Issues</a></li>
<li><a href="/snippets">Snippets</a></li>
</ul>
</section>
</div>
</div>
</div>
<script src="https://djfaa0bz60cz6.cloudfront.net/assets/application-70afe6376892ea318388e4bbb986d5a1.js"></script>

<script>
  new Wincent.Menu();
</script>
</body>
</html>
