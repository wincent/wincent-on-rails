-if @post.public?
  -atom_link @post
.post
  -@page_title = @post.title
  %h1.major=h @post.title
  .when=timeinfo @post
  .excerpt=excerpt_html
  .body=body_html
=render 'shared/tags', :tags => @post.tags
%p.links
  -if admin?
    =link_to 'edit', edit_post_path(@post)
  =link_to 'all posts', posts_path
-if @post.accepts_comments? || @post.comments_count != 0
  -# TODO: use divs to color-code comments (ie. private, awaiting moderation etc)
  =named_anchor 'comments'
  %h2.major
    Comments
    =feed_icon post_path(@post, :format => :atom)
  %table.comments
    -for comment in @comments
      %tr{ :class => "comment #{cycle('even', 'odd')}" + (comment.public? ? '' : ' private'), :id => "comment_#{comment.id}" }
        %th
          =link_to_user comment.user
          %br
          =pluralizing_count(comment.user.utterances_count, 'post') if comment.user
          %br
          %span.when=timeinfo comment, :updated_string => 'edited'
          -if admin?
            %br
            =link_to 'edit', edit_comment_path(comment)
            -# TODO: add a means of marking individual comments as private
        %td=comment.body.w :base_heading_level => 2
  %h2.major Add a comment
  -if @comment
    =render 'comments/comment'
  -else
    -# comments are currently closed but they were open in the past because we have at least one existing comment
    %p==Comments are now closed for this post. You can discuss this further in the #{link_to 'forums', forums_path}.
