(function() {
  clearAJAXFlash();
  <% if @comment.new_record? -%>
    <%# TODO: if there are validation errors, show them (only possible validation error is empty body) %>
    insertAJAXFlash('error', 'Failed to add new comment');
  <% else -%>
    var links = $('#comment-form .links');
    links.siblings().hide();
    links.show().find('a').click(function() {
      clearAJAXFlash();
      links.hide().siblings().show();
      $('#comment-form textarea').val('');
    });
    <% if @comment.awaiting_moderation -%>
      insertAJAXFlash('notice', 'Your comment has been queued for moderation');
    <% else -%>
      $('#comments').html('<%= escape_javascript(render @parent.comments) %>');
    <% end -%>
  <% end -%>
})();
